"use strict";(self["webpackChunkoci_help_web"]=self["webpackChunkoci_help_web"]||[]).push([[572],{5572:function(e,a,t){t.r(a),t.d(a,{default:function(){return C}});var l=t(6768);const s={class:"tab-content"},o={key:0},d={key:1};function r(e,a,t,r,n,i){const c=(0,l.g2)("Setting"),p=(0,l.g2)("el-icon"),u=(0,l.g2)("el-tab-pane"),g=(0,l.g2)("DocumentCopy"),m=(0,l.g2)("BasicCfg"),f=(0,l.g2)("BackUp"),b=(0,l.g2)("el-tabs");return(0,l.uX)(),(0,l.Wv)(b,{type:"border-card",class:"demo-tabs",modelValue:n.activeTab,"onUpdate:modelValue":a[0]||(a[0]=e=>n.activeTab=e)},{default:(0,l.k6)((()=>[(0,l.bF)(u,{label:"basicCfg",name:"basicCfg"},{label:(0,l.k6)((()=>[(0,l.Lk)("span",null,[(0,l.bF)(p,null,{default:(0,l.k6)((()=>[(0,l.bF)(c)])),_:1}),a[1]||(a[1]=(0,l.Lk)("span",{style:{"margin-left":"5px"}},"基本设置",-1))])])),_:1}),(0,l.bF)(u,{label:"backup",name:"backup"},{label:(0,l.k6)((()=>[(0,l.Lk)("span",null,[(0,l.bF)(p,null,{default:(0,l.k6)((()=>[(0,l.bF)(g)])),_:1}),a[2]||(a[2]=(0,l.Lk)("span",{style:{"margin-left":"5px"}},"备份恢复",-1))])])),_:1}),(0,l.Lk)("div",s,["basicCfg"===n.activeTab?((0,l.uX)(),(0,l.CE)("div",o,[(0,l.bF)(m)])):(0,l.Q3)("",!0),"backup"===n.activeTab?((0,l.uX)(),(0,l.CE)("div",d,[(0,l.bF)(f)])):(0,l.Q3)("",!0)])])),_:1},8,["modelValue"])}const n={key:0,class:"image-preview"};function i(e,a,t,s,o,d){const r=(0,l.g2)("el-text"),i=(0,l.g2)("el-input"),c=(0,l.g2)("el-form-item"),p=(0,l.g2)("el-form"),u=(0,l.g2)("el-divider"),g=(0,l.g2)("el-switch"),m=(0,l.g2)("el-image"),f=(0,l.g2)("el-button"),b=(0,l.g2)("el-aside"),y=(0,l.g2)("el-main"),k=(0,l.g2)("el-container");return(0,l.uX)(),(0,l.Wv)(k,{style:{height:"100vh"}},{default:(0,l.k6)((()=>[(0,l.bF)(b,{width:"700px",class:"left-panel"},{default:(0,l.k6)((()=>[(0,l.bF)(p,null,{default:(0,l.k6)((()=>[(0,l.bF)(r,{class:"mx-1",size:"large"},{default:(0,l.k6)((()=>a[7]||(a[7]=[(0,l.eW)("telegram机器人Token")]))),_:1}),(0,l.bF)(c,{style:{"margin-top":"10px"}},{default:(0,l.k6)((()=>[(0,l.bF)(i,{modelValue:o.UpdateSysCfgParams.tgBotToken,"onUpdate:modelValue":a[0]||(a[0]=e=>o.UpdateSysCfgParams.tgBotToken=e),placeholder:"12345678:AAGC8NFfxxxx",clearable:"",type:"password","show-password":""},null,8,["modelValue"])])),_:1}),(0,l.bF)(r,{class:"mx-1",size:"large"},{default:(0,l.k6)((()=>a[8]||(a[8]=[(0,l.eW)("telegram个人ID")]))),_:1}),(0,l.bF)(c,{style:{"margin-top":"10px"}},{default:(0,l.k6)((()=>[(0,l.bF)(i,{modelValue:o.UpdateSysCfgParams.tgChatId,"onUpdate:modelValue":a[1]||(a[1]=e=>o.UpdateSysCfgParams.tgChatId=e),placeholder:"61945xxxxx",clearable:"",type:"password","show-password":""},null,8,["modelValue"])])),_:1}),(0,l.bF)(r,{class:"mx-1",size:"large"},{default:(0,l.k6)((()=>a[9]||(a[9]=[(0,l.eW)("钉钉access_token")]))),_:1}),(0,l.bF)(c,{style:{"margin-top":"10px"}},{default:(0,l.k6)((()=>[(0,l.bF)(i,{modelValue:o.UpdateSysCfgParams.dingToken,"onUpdate:modelValue":a[2]||(a[2]=e=>o.UpdateSysCfgParams.dingToken=e),placeholder:"0b0bf9f89xxxx",clearable:"",type:"password","show-password":""},null,8,["modelValue"])])),_:1}),(0,l.bF)(r,{class:"mx-1",size:"large"},{default:(0,l.k6)((()=>a[10]||(a[10]=[(0,l.eW)("钉钉secret")]))),_:1}),(0,l.bF)(c,{style:{"margin-top":"10px"}},{default:(0,l.k6)((()=>[(0,l.bF)(i,{modelValue:o.UpdateSysCfgParams.dingSecret,"onUpdate:modelValue":a[3]||(a[3]=e=>o.UpdateSysCfgParams.dingSecret=e),placeholder:"SEC1ebxxxx",clearable:"",type:"password","show-password":""},null,8,["modelValue"])])),_:1})])),_:1}),(0,l.bF)(u,{class:"divider"}),(0,l.bF)(p,null,{default:(0,l.k6)((()=>[(0,l.bF)(c,{label:"是否启用MFA（推荐谷歌）：",style:{"margin-top":"10px"}},{default:(0,l.k6)((()=>[(0,l.bF)(g,{modelValue:o.UpdateSysCfgParams.enableMfa,"onUpdate:modelValue":a[4]||(a[4]=e=>o.UpdateSysCfgParams.enableMfa=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])])),_:1}),(0,l.bF)(r,{class:"mx-1"},{default:(0,l.k6)((()=>a[11]||(a[11]=[(0,l.eW)("⭐PS：如果禁用后重新启用，需要在APP上删除旧的验证码，重新扫码绑定新的MFA验证码❗❗❗")]))),_:1}),o.UpdateSysCfgParams.enableMfa?((0,l.uX)(),(0,l.CE)("div",n,[(0,l.bF)(m,{style:{"margin-top":"20px",width:"300px",height:"300px"},src:o.UpdateSysCfgParams.mfaQrData,fit:"contain"},null,8,["src"]),(0,l.bF)(i,{modelValue:o.UpdateSysCfgParams.mfaSecret,"onUpdate:modelValue":a[5]||(a[5]=e=>o.UpdateSysCfgParams.mfaSecret=e),style:{"margin-top":"10px",width:"400px"},disabled:"",placeholder:"",label:""},null,8,["modelValue"])])):(0,l.Q3)("",!0)])),_:1}),(0,l.bF)(f,{type:"primary",style:{"margin-top":"10px"},onClick:d.updateSysCfg,loading:o.cfgLoading},{default:(0,l.k6)((()=>a[12]||(a[12]=[(0,l.eW)(" 更新配置 ")]))),_:1},8,["onClick","loading"])])),_:1}),(0,l.bF)(y,{class:"right-panel"},{default:(0,l.k6)((()=>[(0,l.bF)(i,{type:"textarea",modelValue:o.message,"onUpdate:modelValue":a[6]||(a[6]=e=>o.message=e),placeholder:"输入测试文本",rows:20},null,8,["modelValue"]),(0,l.bF)(f,{type:"primary",onClick:d.sendMsg,loading:o.sendLoading},{default:(0,l.k6)((()=>a[13]||(a[13]=[(0,l.eW)("测试消息发送")]))),_:1},8,["onClick","loading"])])),_:1})])),_:1})}var c=t(1219),p={data(){return{cfgLoading:!1,sendLoading:!1,UpdateSysCfgParams:{dingToken:"",dingSecret:"",tgChatId:"",tgBotToken:"",enableMfa:"",mfaSecret:"",mfaQrData:""},message:""}},mounted(){this.getSysCfg()},methods:{async getSysCfg(){await this.$axios.post("/sys/getSysCfg",{}).then((e=>{e.data.success?this.UpdateSysCfgParams=e.data.data:(0,c.nk)({message:e.data.msg,type:"error",duration:2e3})})).catch((e=>{console.error("Error:",e)}))},async updateSysCfg(){this.cfgLoading=!0,await this.$axios.post("/sys/updateSysCfg",{...this.UpdateSysCfgParams}).then((e=>{e.data.success?((0,c.nk)({message:e.data.msg,type:"success",duration:2e3}),this.cfgLoading=!1,this.getSysCfg()):(0,c.nk)({message:e.data.msg,type:"error",duration:2e3})})).catch((e=>{console.error("Error:",e)}))},async sendMsg(){this.sendLoading=!0,await this.$axios.post("/sys/sendMsg",{message:this.message}).then((e=>{e.data.success?((0,c.nk)({message:e.data.msg,type:"success",duration:2e3}),this.sendLoading=!1):(0,c.nk)({message:e.data.msg,type:"error",duration:2e3})})).catch((e=>{console.error("Error:",e)}))}}},u=t(1241);const g=(0,u.A)(p,[["render",i],["__scopeId","data-v-3fc8da7e"]]);var m=g,f=t(5130);function b(e,a,t,s,o,d){const r=(0,l.g2)("el-switch"),n=(0,l.g2)("el-form-item"),i=(0,l.g2)("el-input"),c=(0,l.g2)("el-button"),p=(0,l.g2)("el-divider"),u=(0,l.g2)("el-text"),g=(0,l.g2)("upload-filled"),m=(0,l.g2)("el-icon"),b=(0,l.g2)("el-upload"),y=(0,l.g2)("el-form");return(0,l.uX)(),(0,l.CE)("div",null,[(0,l.bF)(y,null,{default:(0,l.k6)((()=>[(0,l.bF)(n,{label:"是否启用加密"},{default:(0,l.k6)((()=>[(0,l.bF)(r,{modelValue:o.BackupParams.enableEnc,"onUpdate:modelValue":a[0]||(a[0]=e=>o.BackupParams.enableEnc=e)},null,8,["modelValue"])])),_:1}),(0,l.bo)((0,l.bF)(n,{label:"密钥"},{default:(0,l.k6)((()=>[(0,l.bF)(i,{modelValue:o.BackupParams.password,"onUpdate:modelValue":a[1]||(a[1]=e=>o.BackupParams.password=e),placeholder:"输入密钥",type:"password","show-password":"",clearable:"",style:{width:"400px"}},null,8,["modelValue"])])),_:1},512),[[f.aG,o.BackupParams.enableEnc]]),(0,l.bF)(n,null,{default:(0,l.k6)((()=>[(0,l.bF)(c,{type:"primary",onClick:d.handleBackup,style:{width:"430px"}},{default:(0,l.k6)((()=>a[3]||(a[3]=[(0,l.eW)("备份并下载")]))),_:1},8,["onClick"])])),_:1}),(0,l.bF)(p,{class:"divider"}),(0,l.bF)(u,{class:"mx-1"},{default:(0,l.k6)((()=>a[4]||(a[4]=[(0,l.eW)("上传备份文件")]))),_:1}),(0,l.bF)(n,{label:"",style:{"margin-top":"10px"}},{default:(0,l.k6)((()=>[(0,l.bF)(b,{class:"upload-demo",drag:"","http-request":d.handleFileUpload,multiple:"","show-file-list":!0,"file-list":o.RecoverParams.fileList,style:{width:"400px"}},{tip:(0,l.k6)((()=>a[5]||(a[5]=[(0,l.Lk)("div",{class:"el-upload__tip"}," ⭐请上传备份压缩包文件 ",-1)]))),default:(0,l.k6)((()=>[(0,l.bF)(m,{class:"el-icon--upload"},{default:(0,l.k6)((()=>[(0,l.bF)(g)])),_:1}),a[6]||(a[6]=(0,l.Lk)("div",{class:"el-upload__text"},[(0,l.eW)(" Drop file here or "),(0,l.Lk)("em",null,"click to upload")],-1))])),_:1},8,["http-request","file-list"])])),_:1}),(0,l.bF)(n,{label:"密钥"},{default:(0,l.k6)((()=>[(0,l.bF)(i,{modelValue:o.RecoverParams.encryptionKey,"onUpdate:modelValue":a[2]||(a[2]=e=>o.RecoverParams.encryptionKey=e),placeholder:"输入密钥（可选）",clearable:"",style:{width:"400px"},type:"password","show-password":""},null,8,["modelValue"])])),_:1}),(0,l.bF)(n,null,{default:(0,l.k6)((()=>[(0,l.bF)(c,{type:"primary",onClick:d.handleRecover,style:{width:"430px"},loading:o.RecoverLoading},{default:(0,l.k6)((()=>a[7]||(a[7]=[(0,l.eW)("恢复数据 ")]))),_:1},8,["onClick","loading"])])),_:1})])),_:1})])}t(4114),t(8992),t(3949),t(4603),t(7566),t(8721);var y=t(7477),k={components:{UploadFilled:y.UploadFilled},data(){return{BackupParams:{enableEnc:!1,password:""},RecoverParams:{encryptionKey:"",fileList:[]},RecoverLoading:!1}},methods:{async handleBackup(){try{const e=await this.$axios.post("/sys/backup",{...this.BackupParams},{responseType:"blob"});let a="backup.zip";const t=e.headers["content-disposition"];if(t){const e=/filename\*?=(?:.*'')?(.+)/,l=e.exec(t);l&&l[1]&&(a=decodeURIComponent(l[1]))}const l=new Blob([e.data],{type:"application/octet-stream"}),s=window.URL.createObjectURL(l),o=document.createElement("a");o.href=s,o.download=a,o.click(),window.URL.revokeObjectURL(s),(0,c.nk)({message:"备份文件已成功下载",type:"success",duration:2e3})}catch(e){console.error("Error during backup:",e),(0,c.nk)({message:"备份失败，请重试",type:"error",duration:2e3})}},handleFileUpload({file:e}){const a=new FileReader;a.onload=a=>{const t=a.target.result;t&&this.RecoverParams.fileList.push(e)},a.readAsArrayBuffer(e)},async handleRecover(){this.RecoverLoading=!0;const e=new FormData;e.append("encryptionKey",this.RecoverParams.encryptionKey),this.RecoverParams.fileList.forEach((a=>{e.append("fileList",a)})),await this.$axios.post("/sys/recover",e,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{e.data.success?(this.resetForm(),(0,c.nk)({message:e.data.msg,type:"success",duration:2e3})):(this.RecoverLoading=!1,(0,c.nk)({message:e.data.msg,type:"error",duration:2e3}))})).catch((e=>{console.error("Error:",e)})),this.resetForm()},resetForm(){this.BackupParams={enableEnc:!1,password:""},this.RecoverParams={encryptionKey:"",fileList:[]},this.RecoverLoading=!1}}};const h=(0,u.A)(k,[["render",b],["__scopeId","data-v-961fa512"]]);var F=h,x={data(){return{activeTab:"basicCfg"}},components:{BasicCfg:m,BackUp:F}};const w=(0,u.A)(x,[["render",r]]);var C=w}}]);
//# sourceMappingURL=572.3f7a729a.js.map