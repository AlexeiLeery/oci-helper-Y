"use strict";(self["webpackChunkoci_help_web"]=self["webpackChunkoci_help_web"]||[]).push([[738],{6738:function(e,a,l){l.r(a),l.d(a,{default:function(){return _}});var s=l(6768);const t={class:"tab-content"},o={key:0},d={key:1};function n(e,a,l,n,r,c){const i=(0,s.g2)("Setting"),u=(0,s.g2)("el-icon"),p=(0,s.g2)("el-tab-pane"),m=(0,s.g2)("DocumentCopy"),g=(0,s.g2)("BasicCfg"),f=(0,s.g2)("BackUp"),b=(0,s.g2)("el-tabs");return(0,s.uX)(),(0,s.Wv)(b,{type:"border-card",class:"demo-tabs",modelValue:r.activeTab,"onUpdate:modelValue":a[0]||(a[0]=e=>r.activeTab=e)},{default:(0,s.k6)((()=>[(0,s.bF)(p,{label:"basicCfg",name:"basicCfg"},{label:(0,s.k6)((()=>[(0,s.Lk)("span",null,[(0,s.bF)(u,null,{default:(0,s.k6)((()=>[(0,s.bF)(i)])),_:1}),a[1]||(a[1]=(0,s.Lk)("span",{style:{"margin-left":"5px"}},"基本设置",-1))])])),_:1}),(0,s.bF)(p,{label:"backup",name:"backup"},{label:(0,s.k6)((()=>[(0,s.Lk)("span",null,[(0,s.bF)(u,null,{default:(0,s.k6)((()=>[(0,s.bF)(m)])),_:1}),a[2]||(a[2]=(0,s.Lk)("span",{style:{"margin-left":"5px"}},"备份恢复",-1))])])),_:1}),(0,s.Lk)("div",t,["basicCfg"===r.activeTab?((0,s.uX)(),(0,s.CE)("div",o,[(0,s.bF)(g)])):(0,s.Q3)("",!0),"backup"===r.activeTab?((0,s.uX)(),(0,s.CE)("div",d,[(0,s.bF)(f)])):(0,s.Q3)("",!0)])])),_:1},8,["modelValue"])}const r={key:0,class:"mfa-tip"},c={key:1,class:"mfa-preview"},i={class:"button-group"},u={class:"button-group"},p={class:"button-group"};function m(e,a,l,t,o,d){const n=(0,s.g2)("el-divider"),m=(0,s.g2)("el-input"),g=(0,s.g2)("el-form-item"),f=(0,s.g2)("el-switch"),b=(0,s.g2)("el-image"),k=(0,s.g2)("el-button"),y=(0,s.g2)("el-card"),h=(0,s.g2)("el-aside"),C=(0,s.g2)("el-main"),F=(0,s.g2)("el-container");return(0,s.uX)(),(0,s.Wv)(F,{style:{height:"100vh",background:"#f9f9f9"}},{default:(0,s.k6)((()=>[(0,s.bF)(h,{width:"50%",class:"left-panel"},{default:(0,s.k6)((()=>[(0,s.bF)(y,{shadow:"hover",class:"settings-card"},{default:(0,s.k6)((()=>[a[12]||(a[12]=(0,s.Lk)("h3",null,"基本设置",-1)),(0,s.bF)(n),a[13]||(a[13]=(0,s.Lk)("h4",null,"Telegram 配置",-1)),(0,s.bF)(g,{label:"机器人 Token"},{default:(0,s.k6)((()=>[(0,s.bF)(m,{modelValue:o.UpdateSysCfgParams.tgBotToken,"onUpdate:modelValue":a[0]||(a[0]=e=>o.UpdateSysCfgParams.tgBotToken=e),placeholder:"请输入 Telegram Bot Token",clearable:"",type:"password","show-password":""},null,8,["modelValue"])])),_:1}),(0,s.bF)(g,{label:"个人 ID"},{default:(0,s.k6)((()=>[(0,s.bF)(m,{modelValue:o.UpdateSysCfgParams.tgChatId,"onUpdate:modelValue":a[1]||(a[1]=e=>o.UpdateSysCfgParams.tgChatId=e),placeholder:"请输入 Telegram 个人 ID",clearable:"",type:"password","show-password":""},null,8,["modelValue"])])),_:1}),a[14]||(a[14]=(0,s.Lk)("h4",null,"钉钉配置",-1)),(0,s.bF)(g,{label:"Access Token"},{default:(0,s.k6)((()=>[(0,s.bF)(m,{modelValue:o.UpdateSysCfgParams.dingToken,"onUpdate:modelValue":a[2]||(a[2]=e=>o.UpdateSysCfgParams.dingToken=e),placeholder:"请输入钉钉 Access Token",clearable:"",type:"password","show-password":""},null,8,["modelValue"])])),_:1}),(0,s.bF)(g,{label:"Secret"},{default:(0,s.k6)((()=>[(0,s.bF)(m,{modelValue:o.UpdateSysCfgParams.dingSecret,"onUpdate:modelValue":a[3]||(a[3]=e=>o.UpdateSysCfgParams.dingSecret=e),placeholder:"请输入钉钉 Secret",clearable:"",type:"password","show-password":""},null,8,["modelValue"])])),_:1}),a[15]||(a[15]=(0,s.Lk)("h4",null,"版本更新通知配置",-1)),(0,s.bF)(g,{label:"是否启用版本更新通知"},{default:(0,s.k6)((()=>[(0,s.bF)(f,{modelValue:o.UpdateSysCfgParams.enableVersionInform,"onUpdate:modelValue":a[4]||(a[4]=e=>o.UpdateSysCfgParams.enableVersionInform=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])])),_:1}),a[16]||(a[16]=(0,s.Lk)("h4",null,"每日播报配置",-1)),(0,s.bF)(g,{label:"是否启用每日播报"},{default:(0,s.k6)((()=>[(0,s.bF)(f,{modelValue:o.UpdateSysCfgParams.enableDailyBroadcast,"onUpdate:modelValue":a[5]||(a[5]=e=>o.UpdateSysCfgParams.enableDailyBroadcast=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])])),_:1}),(0,s.bF)(g,{label:"定时任务cron表达式"},{default:(0,s.k6)((()=>[(0,s.bF)(m,{modelValue:o.UpdateSysCfgParams.dailyBroadcastCron,"onUpdate:modelValue":a[6]||(a[6]=e=>o.UpdateSysCfgParams.dailyBroadcastCron=e),placeholder:"例（每天早晨9点30分0秒）：0 30 9 * * ?",clearable:""},null,8,["modelValue"])])),_:1}),a[17]||(a[17]=(0,s.Lk)("h4",null,"MFA 配置",-1)),(0,s.bF)(g,{label:"启用 MFA"},{default:(0,s.k6)((()=>[(0,s.bF)(f,{modelValue:o.UpdateSysCfgParams.enableMfa,"onUpdate:modelValue":a[7]||(a[7]=e=>o.UpdateSysCfgParams.enableMfa=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])])),_:1}),o.UpdateSysCfgParams.enableMfa?((0,s.uX)(),(0,s.CE)("p",r," ⭐ 如果禁用后重新启用，请在 APP 上删除旧验证码并重新扫码绑定新验证码。 ")):(0,s.Q3)("",!0),o.UpdateSysCfgParams.enableMfa?((0,s.uX)(),(0,s.CE)("div",c,[(0,s.bF)(b,{src:o.UpdateSysCfgParams.mfaQrData,fit:"contain",style:{width:"200px",height:"200px"}},null,8,["src"]),(0,s.bF)(m,{modelValue:o.UpdateSysCfgParams.mfaSecret,"onUpdate:modelValue":a[8]||(a[8]=e=>o.UpdateSysCfgParams.mfaSecret=e),style:{"margin-top":"10px"},disabled:""},null,8,["modelValue"])])):(0,s.Q3)("",!0),(0,s.Lk)("div",i,[(0,s.bF)(k,{type:"primary",onClick:d.updateSysCfg,loading:o.cfgLoading},{default:(0,s.k6)((()=>a[11]||(a[11]=[(0,s.eW)("更新配置")]))),_:1},8,["onClick","loading"])])])),_:1})])),_:1}),(0,s.bF)(C,{class:"right-panel"},{default:(0,s.k6)((()=>[(0,s.bF)(y,{shadow:"hover",class:"test-card"},{default:(0,s.k6)((()=>[a[20]||(a[20]=(0,s.Lk)("h3",null,"测试消息发送",-1)),(0,s.bF)(m,{type:"textarea",modelValue:o.message,"onUpdate:modelValue":a[9]||(a[9]=e=>o.message=e),placeholder:"请输入测试文本...",rows:10,resize:"none"},null,8,["modelValue"]),(0,s.Lk)("div",u,[(0,s.bF)(k,{type:"primary",onClick:d.sendMsg,loading:o.sendLoading},{default:(0,s.k6)((()=>a[18]||(a[18]=[(0,s.eW)("发送测试消息")]))),_:1},8,["onClick","loading"])]),(0,s.bF)(n),a[21]||(a[21]=(0,s.Lk)("h3",null,"测试MFA验证码",-1)),(0,s.bF)(m,{modelValue:o.mfaCode,"onUpdate:modelValue":a[10]||(a[10]=e=>o.mfaCode=e),clearable:"",placeholder:"请输入MFA验证码"},null,8,["modelValue"]),(0,s.Lk)("div",p,[(0,s.bF)(k,{type:"primary",onClick:d.checkMfaCode,loading:o.sendMfaCodeLoading},{default:(0,s.k6)((()=>a[19]||(a[19]=[(0,s.eW)("验证")]))),_:1},8,["onClick","loading"])])])),_:1})])),_:1})])),_:1})}var g=l(1219),f={data(){return{cfgLoading:!1,sendLoading:!1,sendMfaCodeLoading:!1,UpdateSysCfgParams:{dingToken:"",dingSecret:"",tgChatId:"",tgBotToken:"",enableMfa:!1,mfaSecret:"",mfaQrData:"",enableDailyBroadcast:!0,dailyBroadcastCron:"",enableVersionInform:!0},message:"",mfaCode:""}},mounted(){this.getSysCfg()},methods:{async getSysCfg(){await this.$axios.post("/sys/getSysCfg",{}).then((e=>{e.data.success?((0,g.nk)({message:e.data.msg,type:"success",duration:2e3}),this.UpdateSysCfgParams=e.data.data):(0,g.nk)({message:e.data.msg,type:"error",duration:2e3})})).catch((e=>{console.error("Error:",e)}))},async updateSysCfg(){this.cfgLoading=!0,await this.$axios.post("/sys/updateSysCfg",{...this.UpdateSysCfgParams}).then((e=>{e.data.success?((0,g.nk)({message:e.data.msg,type:"success",duration:2e3}),this.getSysCfg()):(0,g.nk)({message:e.data.msg,type:"error",duration:2e3})})).catch((e=>{console.error("Error:",e)})),this.cfgLoading=!1},async sendMsg(){this.sendLoading=!0,await this.$axios.post("/sys/sendMsg",{message:this.message}).then((e=>{e.data.success?(0,g.nk)({message:e.data.msg,type:"success",duration:2e3}):(0,g.nk)({message:e.data.msg,type:"error",duration:2e3})})).catch((e=>{console.error("Error:",e)})),this.sendLoading=!1},async checkMfaCode(){this.sendMfaCodeLoading=!0,await this.$axios.post("/sys/checkMfaCode",{mfaCode:this.mfaCode}).then((e=>{e.data.success?(0,g.nk)({message:e.data.msg,type:"success",duration:2e3}):(0,g.nk)({message:e.data.msg,type:"error",duration:2e3})})).catch((e=>{console.error("Error:",e)})),this.sendMfaCodeLoading=!1}}},b=l(1241);const k=(0,b.A)(f,[["render",m],["__scopeId","data-v-0c472cd4"]]);var y=k,h=l(5130);function C(e,a,l,t,o,d){const n=(0,s.g2)("el-switch"),r=(0,s.g2)("el-form-item"),c=(0,s.g2)("el-input"),i=(0,s.g2)("el-button"),u=(0,s.g2)("el-divider"),p=(0,s.g2)("el-text"),m=(0,s.g2)("upload-filled"),g=(0,s.g2)("el-icon"),f=(0,s.g2)("el-upload"),b=(0,s.g2)("el-form");return(0,s.uX)(),(0,s.CE)("div",null,[(0,s.bF)(b,null,{default:(0,s.k6)((()=>[(0,s.bF)(r,{label:"是否启用加密"},{default:(0,s.k6)((()=>[(0,s.bF)(n,{modelValue:o.BackupParams.enableEnc,"onUpdate:modelValue":a[0]||(a[0]=e=>o.BackupParams.enableEnc=e)},null,8,["modelValue"])])),_:1}),(0,s.bo)((0,s.bF)(r,{label:"密钥"},{default:(0,s.k6)((()=>[(0,s.bF)(c,{modelValue:o.BackupParams.password,"onUpdate:modelValue":a[1]||(a[1]=e=>o.BackupParams.password=e),placeholder:"输入密钥",type:"password","show-password":"",clearable:"",style:{width:"400px"}},null,8,["modelValue"])])),_:1},512),[[h.aG,o.BackupParams.enableEnc]]),(0,s.bF)(r,null,{default:(0,s.k6)((()=>[(0,s.bF)(i,{type:"primary",onClick:d.handleBackup,style:{width:"430px"}},{default:(0,s.k6)((()=>a[3]||(a[3]=[(0,s.eW)("备份并下载")]))),_:1},8,["onClick"])])),_:1}),(0,s.bF)(u,{class:"divider"}),(0,s.bF)(p,{class:"mx-1"},{default:(0,s.k6)((()=>a[4]||(a[4]=[(0,s.eW)("上传备份文件")]))),_:1}),(0,s.bF)(r,{label:"",style:{"margin-top":"10px"}},{default:(0,s.k6)((()=>[(0,s.bF)(f,{class:"upload-demo",drag:"","http-request":d.handleFileUpload,multiple:"","show-file-list":!0,"file-list":o.RecoverParams.fileList,style:{width:"400px"}},{tip:(0,s.k6)((()=>a[5]||(a[5]=[(0,s.Lk)("div",{class:"el-upload__tip"}," ⭐请上传备份压缩包文件 ",-1)]))),default:(0,s.k6)((()=>[(0,s.bF)(g,{class:"el-icon--upload"},{default:(0,s.k6)((()=>[(0,s.bF)(m)])),_:1}),a[6]||(a[6]=(0,s.Lk)("div",{class:"el-upload__text"},[(0,s.eW)(" Drop file here or "),(0,s.Lk)("em",null,"click to upload")],-1))])),_:1},8,["http-request","file-list"])])),_:1}),(0,s.bF)(r,{label:"密钥"},{default:(0,s.k6)((()=>[(0,s.bF)(c,{modelValue:o.RecoverParams.encryptionKey,"onUpdate:modelValue":a[2]||(a[2]=e=>o.RecoverParams.encryptionKey=e),placeholder:"输入密钥（可选）",clearable:"",style:{width:"400px"},type:"password","show-password":""},null,8,["modelValue"])])),_:1}),(0,s.bF)(r,null,{default:(0,s.k6)((()=>[(0,s.bF)(i,{type:"primary",onClick:d.handleRecover,style:{width:"430px"},loading:o.RecoverLoading},{default:(0,s.k6)((()=>a[7]||(a[7]=[(0,s.eW)("恢复数据 ")]))),_:1},8,["onClick","loading"])])),_:1})])),_:1})])}l(4114),l(8992),l(3949),l(4603),l(7566),l(8721);var F=l(7477),v={components:{UploadFilled:F.UploadFilled},data(){return{BackupParams:{enableEnc:!1,password:""},RecoverParams:{encryptionKey:"",fileList:[]},RecoverLoading:!1}},methods:{async handleBackup(){try{const e=await this.$axios.post("/sys/backup",{...this.BackupParams},{responseType:"blob"});let a="backup.zip";const l=e.headers["content-disposition"];if(l){const e=/filename\*?=(?:.*'')?(.+)/,s=e.exec(l);s&&s[1]&&(a=decodeURIComponent(s[1]))}const s=new Blob([e.data],{type:"application/octet-stream"}),t=window.URL.createObjectURL(s),o=document.createElement("a");o.href=t,o.download=a,o.click(),window.URL.revokeObjectURL(t),(0,g.nk)({message:"备份文件已成功下载",type:"success",duration:2e3})}catch(e){console.error("Error during backup:",e),(0,g.nk)({message:"备份失败，请重试",type:"error",duration:2e3})}},handleFileUpload({file:e}){const a=new FileReader;a.onload=a=>{const l=a.target.result;l&&this.RecoverParams.fileList.push(e)},a.readAsArrayBuffer(e)},async handleRecover(){this.RecoverLoading=!0;const e=new FormData;e.append("encryptionKey",this.RecoverParams.encryptionKey),this.RecoverParams.fileList.forEach((a=>{e.append("fileList",a)})),await this.$axios.post("/sys/recover",e,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{e.data.success?(this.resetForm(),(0,g.nk)({message:e.data.msg,type:"success",duration:2e3})):(this.RecoverLoading=!1,(0,g.nk)({message:e.data.msg,type:"error",duration:2e3}))})).catch((e=>{console.error("Error:",e)})),this.resetForm()},resetForm(){this.BackupParams={enableEnc:!1,password:""},this.RecoverParams={encryptionKey:"",fileList:[]},this.RecoverLoading=!1}}};const w=(0,b.A)(v,[["render",C],["__scopeId","data-v-4040861f"]]);var U=w,V={data(){return{activeTab:"basicCfg"}},components:{BasicCfg:y,BackUp:U}};const L=(0,b.A)(V,[["render",n]]);var _=L}}]);
//# sourceMappingURL=738.5ef87f2a.js.map