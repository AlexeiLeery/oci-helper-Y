{"version":3,"file":"js/319.7785bb0e.js","mappings":"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","sources":["webpack://oci-help-web/./src/components/home/OciHome.vue","webpack://oci-help-web/./src/components/home/OciHome.vue?6987"],"sourcesContent":["<template>\r\n  <div>\r\n    <!-- 顶部卡片 -->\r\n    <el-row :gutter=\"20\" class=\"card-container\" v-loading=\"loading\">\r\n      <el-col :span=\"6\">\r\n        <div class=\"data-card\">\r\n          <h3>{{ '总API数量' }}</h3>\r\n          <p>{{ cards.users }}</p>\r\n        </div>\r\n      </el-col>\r\n      <el-col :span=\"6\">\r\n        <div class=\"data-card\">\r\n          <h3>{{ '开机任务数量' }}</h3>\r\n          <p>{{ cards.tasks }}</p>\r\n        </div>\r\n      </el-col>\r\n      <el-col :span=\"6\">\r\n        <div class=\"data-card\">\r\n          <h3>{{ '区域数量' }}</h3>\r\n          <p>{{ cards.regions }}</p>\r\n        </div>\r\n      </el-col>\r\n      <el-col :span=\"6\">\r\n        <div class=\"data-card\">\r\n          <h3>{{ '系统运行天数' }}</h3>\r\n          <p>{{ cards.days }}</p>\r\n        </div>\r\n      </el-col>\r\n    </el-row>\r\n\r\n    <!-- 图表区域 -->\r\n    <el-row :gutter=\"20\" class=\"chart-container\">\r\n      <el-col :span=\"12\">\r\n        <!-- 左侧饼图 -->\r\n        <el-row :gutter=\"20\">\r\n          <el-col :span=\"12\">\r\n            <div class=\"chart\" ref=\"cpuChart\"></div>\r\n          </el-col>\r\n          <el-col :span=\"12\">\r\n            <div class=\"chart\" ref=\"memoryChart\"></div>\r\n          </el-col>\r\n        </el-row>\r\n      </el-col>\r\n      <el-col :span=\"12\">\r\n        <!-- 右侧折线图 -->\r\n        <div class=\"chart\" ref=\"trafficChart\"></div>\r\n      </el-col>\r\n    </el-row>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport * as echarts from 'echarts';\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      loading: false,\r\n      cards: {},\r\n      cpuChart: null,\r\n      memoryChart: null,\r\n      trafficChart: null,\r\n      ws: null,\r\n      reconnectAttempts: 0,\r\n      maxReconnectAttempts: 5,\r\n      reconnectDelay: 5000,\r\n      manualClose: false,\r\n      isReconnecting: false,\r\n    };\r\n  },\r\n  mounted() {\r\n    this.initInfo();\r\n    this.initCharts();\r\n    this.initWebSocket();\r\n    // 添加路由守卫监听\r\n    this.$router.beforeEach((to, from, next) => {\r\n      this.closeWebSocket();\r\n      next();\r\n    });\r\n  },\r\n  beforeUnmount() {\r\n    this.closeWebSocket();\r\n  },\r\n  methods: {\r\n    initInfo() {\r\n      this.loading = true\r\n      this.$axios.get('/sys/glance')\r\n          .then(response => {\r\n            this.cards = response.data.data\r\n            this.loading = false\r\n          })\r\n          .catch(error => {\r\n            console.error(\"Error fetching glance data:\", error);\r\n            throw error;\r\n          })\r\n    },\r\n    initCharts() {\r\n      this.cpuChart = echarts.init(this.$refs.cpuChart);\r\n      this.memoryChart = echarts.init(this.$refs.memoryChart);\r\n      this.trafficChart = echarts.init(this.$refs.trafficChart);\r\n\r\n      this.cpuChart.setOption({\r\n        title: {text: 'CPU 使用率（%）', left: 'center'},\r\n        tooltip: {trigger: 'item'},\r\n        series: [{\r\n          name: 'CPU 使用率（%）',\r\n          type: 'pie',\r\n          radius: '50%',\r\n          data: [],\r\n        }],\r\n      });\r\n\r\n      this.memoryChart.setOption({\r\n        title: {text: 'Memory 使用率（%）', left: 'center'},\r\n        tooltip: {trigger: 'item'},\r\n        series: [{\r\n          name: 'Memory 使用率（%）',\r\n          type: 'pie',\r\n          radius: '50%',\r\n          data: [],\r\n        }],\r\n      });\r\n\r\n      this.trafficChart.setOption({\r\n        title: {text: '流量实时速率（KB/s）', left: 'center'},\r\n        tooltip: {\r\n          trigger: 'axis',\r\n          formatter: function (params) {\r\n            let result = params[0].axisValue + '<br/>';\r\n            params.forEach(param => {\r\n              // 添加每个系列的数据\r\n              result += `${param.seriesName}: ${param.value} KB/s<br/>`;\r\n            });\r\n            return result;\r\n          }\r\n        },\r\n        legend: {  // 添加图例\r\n          data: ['入站', '出站'],\r\n          bottom: 15\r\n        },\r\n        xAxis: {\r\n          type: 'category',\r\n          data: [],\r\n          axisLabel: {\r\n            rotate: 30  // 旋转标签避免重叠\r\n          }\r\n        },\r\n        yAxis: {\r\n          type: 'value',\r\n          axisLabel: {\r\n            formatter: '{value}'\r\n          }\r\n        },\r\n        series: [\r\n          {\r\n            name: '入站',\r\n            type: 'line',\r\n            data: [],\r\n            smooth: true,  // 平滑曲线\r\n            showSymbol: true  // 显示数据点\r\n          },\r\n          {\r\n            name: '出站',\r\n            type: 'line',\r\n            data: [],\r\n            smooth: true,\r\n            showSymbol: true\r\n          }\r\n        ]\r\n      });\r\n    },\r\n\r\n    async closeWebSocket() {\r\n      if (this.ws) {\r\n        if (this.ws.readyState === WebSocket.OPEN) {\r\n          this.ws.close();\r\n          // 等待连接完全关闭\r\n          await new Promise(resolve => {\r\n            this.ws.onclose = () => resolve();\r\n          });\r\n        }\r\n        this.ws = null;\r\n        this.reconnectAttempts = 0;\r\n        this.isReconnecting = false;\r\n      }\r\n    },\r\n\r\n    initWebSocket() {\r\n      try {\r\n        const token = sessionStorage.getItem('token');\r\n        const baseURL = this.$axios.defaults.baseURL.replace(/^http/, 'ws').replaceAll('/api', '');\r\n        const wsURL = `${baseURL}/metrics/${token}`;\r\n\r\n        this.ws = new WebSocket(wsURL);\r\n\r\n        this.ws.onopen = () => {\r\n          console.log('WebSocket connection established.');\r\n          this.reconnectAttempts = 0;\r\n        };\r\n\r\n        this.ws.onmessage = (event) => {\r\n          try {\r\n            const {cpuUsage, memoryUsage, trafficData} = JSON.parse(event.data);\r\n            this.updateCharts(cpuUsage, memoryUsage, trafficData);\r\n          } catch (error) {\r\n            console.error('Error parsing message:', error);\r\n          }\r\n        };\r\n\r\n        this.ws.onclose = (event) => {\r\n          console.log('WebSocket connection closed:', event);\r\n        };\r\n\r\n        this.ws.onerror = (error) => {\r\n          console.error('WebSocket error:', error);\r\n        };\r\n      } catch (error) {\r\n        console.error('Error initializing WebSocket:', error);\r\n      }\r\n    },\r\n\r\n    updateCharts(cpuUsage, memoryUsage, trafficData) {\r\n      // 将图表更新逻辑抽离出来\r\n      if (this.cpuChart) {\r\n        this.cpuChart.setOption({\r\n          series: [{\r\n            data: [\r\n              {value: cpuUsage.used, name: '已使用'},\r\n              {value: cpuUsage.free, name: '空闲'},\r\n            ]\r\n          }],\r\n        });\r\n      }\r\n\r\n      if (this.memoryChart) {\r\n        this.memoryChart.setOption({\r\n          series: [{\r\n            data: [\r\n              {value: memoryUsage.used, name: '已使用'},\r\n              {value: memoryUsage.free, name: '空闲'},\r\n            ]\r\n          }],\r\n        });\r\n      }\r\n\r\n      if (this.trafficChart) {\r\n        this.trafficChart.setOption({\r\n          xAxis: {data: trafficData.timestamps},\r\n          series: [\r\n            {name: '入站', data: trafficData.inbound},\r\n            {name: '出站', data: trafficData.outbound},\r\n          ],\r\n        });\r\n      }\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style>\r\n.card-container {\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.data-card {\r\n  //background: white;\r\n  padding: 20px;\r\n  border-radius: 8px;\r\n  text-align: center;\r\n  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.data-card h3 {\r\n  margin: 0;\r\n  font-size: 16px;\r\n  //color: #888;\r\n}\r\n\r\n.data-card p {\r\n  margin: 0;\r\n  font-size: 24px;\r\n  font-weight: bold;\r\n  //color: #333;\r\n}\r\n\r\n.chart-container {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n}\r\n\r\n.chart {\r\n  width: 100%;\r\n  height: 500px;\r\n  margin-bottom: 20px;\r\n  //background: #fff;\r\n  border: 1px solid #ebebeb;\r\n  border-radius: 8px;\r\n  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\r\n}\r\n</style>\r\n","import { render } from \"./OciHome.vue?vue&type=template&id=226c4a79\"\nimport script from \"./OciHome.vue?vue&type=script&lang=js\"\nexport * from \"./OciHome.vue?vue&type=script&lang=js\"\n\nimport \"./OciHome.vue?vue&type=style&index=0&id=226c4a79&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["class","ref","_createElementBlock","_createBlock","_component_el_row","gutter","default","_withCtx","_createVNode","_component_el_col","span","_createElementVNode","_hoisted_1","_toDisplayString","$data","cards","users","_","_hoisted_2","tasks","_hoisted_3","regions","_hoisted_4","days","loading","_hoisted_5","_hoisted_6","_hoisted_7","data","cpuChart","memoryChart","trafficChart","ws","reconnectAttempts","maxReconnectAttempts","reconnectDelay","manualClose","isReconnecting","mounted","this","initInfo","initCharts","initWebSocket","$router","beforeEach","to","from","next","closeWebSocket","beforeUnmount","methods","$axios","get","then","response","catch","error","console","echarts","$refs","setOption","title","text","left","tooltip","trigger","series","name","type","radius","formatter","params","result","axisValue","forEach","param","seriesName","value","legend","bottom","xAxis","axisLabel","rotate","yAxis","smooth","showSymbol","readyState","WebSocket","OPEN","close","Promise","resolve","onclose","token","sessionStorage","getItem","baseURL","defaults","replace","replaceAll","wsURL","onopen","log","onmessage","event","cpuUsage","memoryUsage","trafficData","JSON","parse","updateCharts","onerror","used","free","timestamps","inbound","outbound","__exports__","render"],"sourceRoot":""}