(function(){"use strict";var e={9995:function(e,t,a){var n=a(5130),s=a(6768);const o={id:"app"};function l(e,t,a,n,l,i){const r=(0,s.g2)("router-view");return(0,s.uX)(),(0,s.CE)("div",o,[(0,s.bF)(r)])}var i={components:{}},r=a(1241);const c=(0,r.A)(i,[["render",l]]);var d=c,u=(a(8992),a(7550),a(1387));const h={class:"login-container"};function p(e,t,a,o,l,i){const r=(0,s.g2)("el-input"),c=(0,s.g2)("el-form-item"),d=(0,s.g2)("el-button"),u=(0,s.g2)("el-form"),p=(0,s.g2)("el-card"),m=(0,s.g2)("el-link"),g=(0,s.g2)("el-footer");return(0,s.uX)(),(0,s.CE)("div",h,[(0,s.bF)(p,{class:"login-card"},{default:(0,s.k6)((()=>[t[4]||(t[4]=(0,s.Lk)("h2",{class:"login-title"},"oci-helper Login",-1)),(0,s.bF)(u,{onSubmit:(0,n.D$)(i.login,["prevent"]),onKeydown:(0,n.jR)((0,n.D$)(i.login,["prevent"]),["enter"])},{default:(0,s.k6)((()=>[(0,s.bF)(c,{label:"","label-width":"0%"},{default:(0,s.k6)((()=>[(0,s.bF)(r,{modelValue:l.loginParams.account,"onUpdate:modelValue":t[0]||(t[0]=e=>l.loginParams.account=e),placeholder:"请输入账号",clearable:""},null,8,["modelValue"])])),_:1}),(0,s.bF)(c,{label:"","label-width":"0%"},{default:(0,s.k6)((()=>[(0,s.bF)(r,{"show-password":"",modelValue:l.loginParams.password,"onUpdate:modelValue":t[1]||(t[1]=e=>l.loginParams.password=e),placeholder:"请输入密码",type:"password",clearable:""},null,8,["modelValue"])])),_:1}),l.enableMfa?((0,s.uX)(),(0,s.Wv)(c,{key:0},{default:(0,s.k6)((()=>[(0,s.bF)(r,{"show-password":"",modelValue:l.loginParams.mfaCode,"onUpdate:modelValue":t[2]||(t[2]=e=>l.loginParams.mfaCode=e),placeholder:"请输入MFA验证码",clearable:""},null,8,["modelValue"])])),_:1})):(0,s.Q3)("",!0),(0,s.bF)(c,{style:{"text-align":"center"},class:"login-button-container"},{default:(0,s.k6)((()=>[(0,s.bF)(d,{type:"primary",onClick:i.login,loading:l.loading,class:"login-button"},{default:(0,s.k6)((()=>t[3]||(t[3]=[(0,s.eW)("Login")]))),_:1},8,["onClick","loading"])])),_:1})])),_:1},8,["onSubmit","onKeydown"])])),_:1}),(0,s.bF)(g,{class:"login-footer"},{default:(0,s.k6)((()=>[(0,s.bF)(m,{href:"https://github.com/Yohann0617",target:"_blank"},{default:(0,s.k6)((()=>t[5]||(t[5]=[(0,s.eW)("© Yohann All Rights Reserved")]))),_:1})])),_:1})])}a(4114);var m=a(1219),g={data(){return{loginParams:{account:"",password:"",mfaCode:null},loading:!1,enableMfa:!1}},mounted(){this.getEnableMfa()},methods:{getEnableMfa(){this.$axios.post("/sys/getEnableMfa",{}).then((e=>{e.data.success?this.enableMfa=e.data.data:(0,m.nk)({message:e.data.msg,type:"error",duration:2e3})})).catch((e=>{console.error("Error:",e)}))},async login(){if("yohann"!==this.loginParams.account||"yohann"!==this.loginParams.password){this.loading=!0;try{const e=await this.$axios.post("/sys/login",{...this.loginParams});e.data.success?((0,m.nk)({message:e.data.msg,type:"success",duration:2e3}),sessionStorage.setItem("token",e.data.data),setTimeout((()=>{this.$router.push("/dashboard")}),2e3)):((0,m.nk)({message:e.data.msg,type:"error",duration:2e3}),this.loading=!1)}catch(e){console.error("Error:",e),(0,m.nk)({message:"登录失败，请重试",type:"error",duration:2e3}),this.loading=!1}}else(0,m.nk)({message:"该账号为默认账号，请修改并重启后再尝试登录",type:"error",duration:2e3})}}};const f=(0,r.A)(g,[["render",p],["__scopeId","data-v-d4e7b4c0"]]);var b=f,k=a(4232);const C={key:0,class:"logo",style:{"text-align":"center"}},y={key:0},F={key:1},_={key:0},v={key:1},I={key:0},w={key:1},x={key:0},P={key:1},S={key:0},L={key:1};function V(e,t,a,n,o,l){const i=(0,s.g2)("Expand"),r=(0,s.g2)("el-icon"),c=(0,s.g2)("Fold"),d=(0,s.g2)("HomeFilled"),u=(0,s.g2)("el-menu-item"),h=(0,s.g2)("UserFilled"),p=(0,s.g2)("Finished"),m=(0,s.g2)("List"),g=(0,s.g2)("Tools"),f=(0,s.g2)("el-menu"),b=(0,s.g2)("el-scrollbar"),V=(0,s.g2)("el-aside"),W=(0,s.g2)("el-header"),E=(0,s.g2)("router-view"),T=(0,s.g2)("el-main"),U=(0,s.g2)("el-link"),A=(0,s.g2)("el-footer"),B=(0,s.g2)("el-container");return(0,s.uX)(),(0,s.Wv)(B,{class:"dashboard-container"},{default:(0,s.k6)((()=>[(0,s.bF)(V,{width:o.isCollapsed?"45px":"180px",class:(0,k.C4)(["sidebar",{collapsed:o.isCollapsed}])},{default:(0,s.k6)((()=>[o.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",C,"oci-helper")),(0,s.Lk)("div",{class:"toggle-button",onClick:t[0]||(t[0]=(...e)=>l.toggleSidebar&&l.toggleSidebar(...e))},[o.isCollapsed?((0,s.uX)(),(0,s.Wv)(r,{key:0},{default:(0,s.k6)((()=>[(0,s.bF)(i)])),_:1})):((0,s.uX)(),(0,s.Wv)(r,{key:1},{default:(0,s.k6)((()=>[(0,s.bF)(c)])),_:1}))]),(0,s.bF)(b,null,{default:(0,s.k6)((()=>[(0,s.bF)(f,{"default-active":o.activeMenu,onSelect:l.handleSelect,router:"",class:"sidebar-menu","background-color":"transparent"},{default:(0,s.k6)((()=>[(0,s.bF)(u,{index:"home"},{default:(0,s.k6)((()=>[t[3]||(t[3]=(0,s.Lk)("i",{class:"el-icon-house"},null,-1)),o.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",y,[(0,s.bF)(r,null,{default:(0,s.k6)((()=>[(0,s.bF)(d)])),_:1}),t[2]||(t[2]=(0,s.eW)("主页"))])),o.isCollapsed?((0,s.uX)(),(0,s.CE)("span",F,[(0,s.bF)(r,null,{default:(0,s.k6)((()=>[(0,s.bF)(d)])),_:1})])):(0,s.Q3)("",!0)])),_:1}),(0,s.bF)(u,{index:"user"},{default:(0,s.k6)((()=>[t[5]||(t[5]=(0,s.Lk)("i",{class:"el-icon-document"},null,-1)),o.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",_,[(0,s.bF)(r,null,{default:(0,s.k6)((()=>[(0,s.bF)(h)])),_:1}),t[4]||(t[4]=(0,s.eW)("配置列表"))])),o.isCollapsed?((0,s.uX)(),(0,s.CE)("span",v,[(0,s.bF)(r,null,{default:(0,s.k6)((()=>[(0,s.bF)(h)])),_:1})])):(0,s.Q3)("",!0)])),_:1}),(0,s.bF)(u,{index:"createTask"},{default:(0,s.k6)((()=>[t[7]||(t[7]=(0,s.Lk)("i",{class:"el-icon-s-management"},null,-1)),o.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",I,[(0,s.bF)(r,null,{default:(0,s.k6)((()=>[(0,s.bF)(p)])),_:1}),t[6]||(t[6]=(0,s.eW)("任务列表"))])),o.isCollapsed?((0,s.uX)(),(0,s.CE)("span",w,[(0,s.bF)(r,null,{default:(0,s.k6)((()=>[(0,s.bF)(p)])),_:1})])):(0,s.Q3)("",!0)])),_:1}),(0,s.bF)(u,{index:"ociLog"},{default:(0,s.k6)((()=>[t[9]||(t[9]=(0,s.Lk)("i",{class:"el-icon-s-operation"},null,-1)),o.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",x,[(0,s.bF)(r,null,{default:(0,s.k6)((()=>[(0,s.bF)(m)])),_:1}),t[8]||(t[8]=(0,s.eW)("服务日志"))])),o.isCollapsed?((0,s.uX)(),(0,s.CE)("span",P,[(0,s.bF)(r,null,{default:(0,s.k6)((()=>[(0,s.bF)(m)])),_:1})])):(0,s.Q3)("",!0)])),_:1}),(0,s.bF)(u,{index:"sysCfg"},{default:(0,s.k6)((()=>[t[11]||(t[11]=(0,s.Lk)("i",{class:"el-icon-s-operation"},null,-1)),o.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",S,[(0,s.bF)(r,null,{default:(0,s.k6)((()=>[(0,s.bF)(g)])),_:1}),t[10]||(t[10]=(0,s.eW)("系统配置"))])),o.isCollapsed?((0,s.uX)(),(0,s.CE)("span",L,[(0,s.bF)(r,null,{default:(0,s.k6)((()=>[(0,s.bF)(g)])),_:1})])):(0,s.Q3)("",!0)])),_:1})])),_:1},8,["default-active","onSelect"])])),_:1})])),_:1},8,["width","class"]),(0,s.bF)(B,null,{default:(0,s.k6)((()=>[(0,s.bF)(W,{class:"header"},{default:(0,s.k6)((()=>[t[12]||(t[12]=(0,s.Lk)("span",null,null,-1)),(0,s.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>l.showLogoutConfirm&&l.showLogoutConfirm(...e)),class:"logout-button"},"退出登录")])),_:1}),(0,s.bF)(T,null,{default:(0,s.k6)((()=>[(0,s.bF)(E)])),_:1}),(0,s.bF)(A,{style:{"text-align":"center"}},{default:(0,s.k6)((()=>[(0,s.bF)(U,{href:"https://github.com/Yohann0617",target:"_blank"},{default:(0,s.k6)((()=>t[13]||(t[13]=[(0,s.eW)("© Yohann All Rights Reserved")]))),_:1})])),_:1})])),_:1})])),_:1})}var W=a(7477),E={components:{Fold:W.Fold,Expand:W.Expand},data(){return{activeMenu:"home",isCollapsed:!1}},methods:{handleSelect(e){this.activeMenu=e,this.$router.push(`/dashboard/${e}`)},toggleSidebar(){this.isCollapsed=!this.isCollapsed},showLogoutConfirm(){const e=window.confirm("确定要退出登录吗?");e?this.logout():this.$message.info("取消退出")},logout(){sessionStorage.removeItem("token"),this.$router.push("/login")}}};const T=(0,r.A)(E,[["render",V],["__scopeId","data-v-83c143ac"]]);var U=T;const A={class:"data-card"},B={class:"data-card"},D={class:"data-card"},R={class:"data-card"},$={class:"chart",ref:"cpuChart"},O={class:"chart",ref:"memoryChart"},N={class:"chart",ref:"trafficChart"};function M(e,t,a,n,o,l){const i=(0,s.g2)("el-col"),r=(0,s.g2)("el-row"),c=(0,s.gN)("loading");return(0,s.uX)(),(0,s.CE)("div",null,[(0,s.bo)(((0,s.uX)(),(0,s.Wv)(r,{gutter:20,class:"card-container"},{default:(0,s.k6)((()=>[(0,s.bF)(i,{span:6},{default:(0,s.k6)((()=>[(0,s.Lk)("div",A,[t[0]||(t[0]=(0,s.Lk)("h3",null,(0,k.v_)("失效API数量 / 总API数量"),-1)),(0,s.Lk)("p",null,(0,k.v_)(o.cards.users),1)])])),_:1}),(0,s.bF)(i,{span:6},{default:(0,s.k6)((()=>[(0,s.Lk)("div",B,[t[1]||(t[1]=(0,s.Lk)("h3",null,(0,k.v_)("开机任务数量"),-1)),(0,s.Lk)("p",null,(0,k.v_)(o.cards.tasks),1)])])),_:1}),(0,s.bF)(i,{span:6},{default:(0,s.k6)((()=>[(0,s.Lk)("div",D,[t[2]||(t[2]=(0,s.Lk)("h3",null,(0,k.v_)("区域数量"),-1)),(0,s.Lk)("p",null,(0,k.v_)(o.cards.regions),1)])])),_:1}),(0,s.bF)(i,{span:6},{default:(0,s.k6)((()=>[(0,s.Lk)("div",R,[t[3]||(t[3]=(0,s.Lk)("h3",null,(0,k.v_)("系统运行天数"),-1)),(0,s.Lk)("p",null,(0,k.v_)(o.cards.days),1)])])),_:1})])),_:1})),[[c,o.loading]]),(0,s.bF)(r,{gutter:20,class:"chart-container"},{default:(0,s.k6)((()=>[(0,s.bF)(i,{span:12},{default:(0,s.k6)((()=>[(0,s.bF)(r,{gutter:20},{default:(0,s.k6)((()=>[(0,s.bF)(i,{span:12},{default:(0,s.k6)((()=>[(0,s.Lk)("div",$,null,512)])),_:1}),(0,s.bF)(i,{span:12},{default:(0,s.k6)((()=>[(0,s.Lk)("div",O,null,512)])),_:1})])),_:1})])),_:1}),(0,s.bF)(i,{span:12},{default:(0,s.k6)((()=>[(0,s.Lk)("div",N,null,512)])),_:1})])),_:1})])}a(3949);var X=a(9671),z={data(){return{loading:!1,cards:{},cpuChart:null,memoryChart:null,trafficChart:null,ws:null,reconnectAttempts:0,maxReconnectAttempts:5,reconnectDelay:5e3,manualClose:!1,isReconnecting:!1}},mounted(){this.initInfo(),this.initCharts(),this.initWebSocket(),this.$router.beforeEach(((e,t,a)=>{this.closeWebSocket(),a()}))},beforeUnmount(){this.closeWebSocket()},methods:{initInfo(){this.loading=!0,this.$axios.get("/sys/glance").then((e=>{this.cards=e.data.data,this.loading=!1})).catch((e=>{throw console.error("Error fetching glance data:",e),e}))},initCharts(){this.cpuChart=X.Ts(this.$refs.cpuChart),this.memoryChart=X.Ts(this.$refs.memoryChart),this.trafficChart=X.Ts(this.$refs.trafficChart),this.cpuChart.setOption({title:{text:"CPU 使用率（%）",left:"center"},tooltip:{trigger:"item"},series:[{name:"CPU 使用率（%）",type:"pie",radius:"50%",data:[]}]}),this.memoryChart.setOption({title:{text:"Memory 使用率（%）",left:"center"},tooltip:{trigger:"item"},series:[{name:"Memory 使用率（%）",type:"pie",radius:"50%",data:[]}]}),this.trafficChart.setOption({title:{text:"流量实时速率（KB/s）",left:"center"},tooltip:{trigger:"axis",formatter:function(e){let t=e[0].axisValue+"<br/>";return e.forEach((e=>{t+=`${e.seriesName}: ${e.value} KB/s<br/>`})),t}},legend:{data:["入站","出站"],bottom:15},xAxis:{type:"category",data:[],axisLabel:{rotate:30}},yAxis:{type:"value",axisLabel:{formatter:"{value}"}},series:[{name:"入站",type:"line",data:[],smooth:!0,showSymbol:!0},{name:"出站",type:"line",data:[],smooth:!0,showSymbol:!0}]})},async closeWebSocket(){this.ws&&(this.ws.readyState===WebSocket.OPEN&&(this.ws.close(),await new Promise((e=>{this.ws.onclose=()=>e()}))),this.ws=null,this.reconnectAttempts=0,this.isReconnecting=!1)},initWebSocket(){try{const e=sessionStorage.getItem("token"),t=this.$axios.defaults.baseURL.replace(/^http/,"ws").replaceAll("/api",""),a=`${t}/metrics/${e}`;this.ws=new WebSocket(a),this.ws.onopen=()=>{console.log("WebSocket connection established."),this.reconnectAttempts=0},this.ws.onmessage=e=>{try{const{cpuUsage:t,memoryUsage:a,trafficData:n}=JSON.parse(e.data);this.updateCharts(t,a,n)}catch(t){console.error("Error parsing message:",t)}},this.ws.onclose=e=>{console.log("WebSocket connection closed:",e)},this.ws.onerror=e=>{console.error("WebSocket error:",e)}}catch(e){console.error("Error initializing WebSocket:",e)}},updateCharts(e,t,a){this.cpuChart&&this.cpuChart.setOption({series:[{data:[{value:e.used,name:"已使用"},{value:e.free,name:"空闲"}]}]}),this.memoryChart&&this.memoryChart.setOption({series:[{data:[{value:t.used,name:"已使用"},{value:t.free,name:"空闲"}]}]}),this.trafficChart&&this.trafficChart.setOption({xAxis:{data:a.timestamps},series:[{name:"入站",data:a.inbound},{name:"出站",data:a.outbound}]})}}};const j=(0,r.A)(z,[["render",M]]);var q=j;const K={style:{"overflow-x":"auto"}},Q={class:"dialog-footer"};function G(e,t,a,n,o,l){const i=(0,s.g2)("el-button"),r=(0,s.g2)("el-input"),c=(0,s.g2)("el-option"),d=(0,s.g2)("el-select"),u=(0,s.g2)("el-table-column"),h=(0,s.g2)("el-tooltip"),p=(0,s.g2)("el-tag"),m=(0,s.g2)("el-table"),g=(0,s.g2)("el-pagination"),f=(0,s.g2)("el-form-item"),b=(0,s.g2)("el-form"),C=(0,s.g2)("el-tab-pane"),y=(0,s.g2)("upload-filled"),F=(0,s.g2)("el-icon"),_=(0,s.g2)("el-upload"),v=(0,s.g2)("el-tabs"),I=(0,s.g2)("el-dialog"),w=(0,s.gN)("loading");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",null,[(0,s.bF)(i,{type:"success",style:{"margin-bottom":"20px"},onClick:l.fetchUsers},{default:(0,s.k6)((()=>t[15]||(t[15]=[(0,s.eW)(" 刷新 ")]))),_:1},8,["onClick"]),(0,s.bF)(i,{type:"primary",onClick:t[0]||(t[0]=e=>o.dialogVisible=!0),style:{"margin-left":"20px","margin-bottom":"20px"}},{default:(0,s.k6)((()=>t[16]||(t[16]=[(0,s.eW)(" 新增配置 ")]))),_:1}),(0,s.bF)(r,{modelValue:o.pageParams.keyword,"onUpdate:modelValue":t[1]||(t[1]=e=>o.pageParams.keyword=e),placeholder:"模糊搜索名称/区域",onInput:l.fetchUsers,clearable:"","prefix-icon":"Search",style:{"margin-left":"20px",width:"200px","margin-bottom":"20px"}},null,8,["modelValue","onInput"]),(0,s.bF)(d,{modelValue:o.pageParams.isEnableCreate,"onUpdate:modelValue":t[2]||(t[2]=e=>o.pageParams.isEnableCreate=e),onChange:l.fetchUsers,placeholder:"开机任务状态筛选",style:{"margin-left":"20px",width:"180px","margin-bottom":"20px"}},{default:(0,s.k6)((()=>[(0,s.bF)(c,{label:"全部",value:null}),(0,s.bF)(c,{label:"仅显示执行开机任务中",value:1}),(0,s.bF)(c,{label:"无开机任务",value:0})])),_:1},8,["modelValue","onChange"]),(0,s.bF)(i,{type:"danger",onClick:l.showDeleteSelected,disabled:!o.selectedUsers.length,style:{"margin-left":"20px","margin-bottom":"20px"}},{default:(0,s.k6)((()=>t[17]||(t[17]=[(0,s.eW)(" 批量删除 ")]))),_:1},8,["onClick","disabled"]),(0,s.bF)(i,{type:"warning",onClick:l.createBatch,disabled:!o.selectedUsers.length,style:{"margin-left":"20px","margin-bottom":"20px"}},{default:(0,s.k6)((()=>t[18]||(t[18]=[(0,s.eW)(" 批量开机 ")]))),_:1},8,["onClick","disabled"]),(0,s.bF)(i,{type:"success",onClick:l.checkAlive,style:{"margin-left":"20px","margin-bottom":"20px"},loading:o.checkLoading},{default:(0,s.k6)((()=>t[19]||(t[19]=[(0,s.eW)(" 一键测活 ")]))),_:1},8,["onClick","loading"]),(0,s.Lk)("div",K,[(0,s.bo)(((0,s.uX)(),(0,s.Wv)(m,{data:o.users,style:{width:"100%","min-width":"800px"},onSelectionChange:l.handleSelectionChange},{default:(0,s.k6)((()=>[(0,s.bF)(u,{type:"selection",width:"55"}),(0,s.bF)(u,{label:"名称"},{default:(0,s.k6)((({row:e})=>[(0,s.bF)(h,{content:e.username,placement:"top"},{default:(0,s.k6)((()=>[(0,s.eW)((0,k.v_)(e.username),1)])),_:2},1032,["content"])])),_:1}),(0,s.bF)(u,{label:"区域"},{default:(0,s.k6)((({row:e})=>[(0,s.bF)(p,{type:"primary"},{default:(0,s.k6)((()=>[(0,s.eW)((0,k.v_)(e.region),1)])),_:2},1024)])),_:1}),(0,s.bF)(u,{label:"开机任务状态"},{default:(0,s.k6)((({row:e})=>[(0,s.bF)(p,{type:1===e.enableCreate?"success":"info"},{default:(0,s.k6)((()=>[(0,s.eW)((0,k.v_)(1===e.enableCreate?"执行开机任务中":"无开机任务"),1)])),_:2},1032,["type"])])),_:1}),(0,s.bF)(u,{sortable:"",prop:"createTime",label:"创建时间"},{default:(0,s.k6)((({row:e})=>[(0,s.bF)(p,{type:"info"},{default:(0,s.k6)((()=>[(0,s.eW)((0,k.v_)(e.createTime),1)])),_:2},1024)])),_:1}),(0,s.bF)(u,{fixed:"right",label:"操作",width:"300"},{default:(0,s.k6)((({row:e})=>[(0,s.bF)(i,{onClick:t=>l.viewDetails(e),type:"primary",link:""},{default:(0,s.k6)((()=>t[20]||(t[20]=[(0,s.eW)("详情")]))),_:2},1032,["onClick"]),(0,s.bF)(i,{onClick:t=>l.releaseSecurityRule(e),type:"success",link:""},{default:(0,s.k6)((()=>t[21]||(t[21]=[(0,s.eW)("安全列表放行")]))),_:2},1032,["onClick"]),(0,s.bF)(i,{onClick:t=>l.createInstance(e),type:"warning",link:""},{default:(0,s.k6)((()=>t[22]||(t[22]=[(0,s.eW)("开机")]))),_:2},1032,["onClick"]),(0,s.bF)(i,{onClick:t=>l.handleStopCreate(e),link:"",type:0===e.enableCreate?"info":"danger",disabled:0===e.enableCreate},{default:(0,s.k6)((()=>t[23]||(t[23]=[(0,s.eW)("停止开机 ")]))),_:2},1032,["onClick","type","disabled"])])),_:1})])),_:1},8,["data","onSelectionChange"])),[[w,o.loading]])]),(0,s.bF)(g,{onCurrentChange:l.handlePageChange,onSizeChange:l.handleSizeChange,"current-page":o.pageParams.currentPage,"onUpdate:currentPage":t[3]||(t[3]=e=>o.pageParams.currentPage=e),"page-size":o.pageParams.pageSize,"onUpdate:pageSize":t[4]||(t[4]=e=>o.pageParams.pageSize=e),"page-sizes":[5,10,20,50],total:o.total,layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"20px"}},null,8,["onCurrentChange","onSizeChange","current-page","page-size","total"])]),(0,s.bF)(I,{modelValue:o.dialogVisible,"onUpdate:modelValue":t[10]||(t[10]=e=>o.dialogVisible=e),title:"新增配置",width:"30%",onClose:t[11]||(t[11]=e=>o.dialogVisible=!1)},{footer:(0,s.k6)((()=>[(0,s.bF)(i,{onClick:t[8]||(t[8]=e=>o.dialogVisible=!1)},{default:(0,s.k6)((()=>t[26]||(t[26]=[(0,s.eW)("取消")]))),_:1}),(0,s.bF)(i,{type:"primary",onClick:t[9]||(t[9]=e=>"manual"===o.activeTab?l.addUser():l.uploadFile()),disabled:("upload"!==o.activeTab||0===this.fileList.length)&&!o.addCfgFormData.disabled,loading:o.addLoading},{default:(0,s.k6)((()=>[(0,s.eW)((0,k.v_)("manual"===o.activeTab?"新增":"上传配置文件"),1)])),_:1},8,["disabled","loading"])])),default:(0,s.k6)((()=>[(0,s.bF)(v,{modelValue:o.activeTab,"onUpdate:modelValue":t[7]||(t[7]=e=>o.activeTab=e)},{default:(0,s.k6)((()=>[(0,s.bF)(C,{label:"手动输入",name:"manual"},{default:(0,s.k6)((()=>[(0,s.bF)(b,{ref:"formRef",model:o.addCfgFormData,rules:o.formRules,"label-width":"80px"},{default:(0,s.k6)((()=>[(0,s.bF)(f,{label:"配置名称",prop:"username"},{default:(0,s.k6)((()=>[(0,s.bF)(r,{modelValue:o.addCfgFormData.username,"onUpdate:modelValue":t[5]||(t[5]=e=>o.addCfgFormData.username=e),placeholder:"请输入配置名称"},null,8,["modelValue"])])),_:1}),(0,s.bF)(f,{label:"配置内容",prop:"ociCfgStr"},{default:(0,s.k6)((()=>[(0,s.bF)(r,{modelValue:o.addCfgFormData.ociCfgStr,"onUpdate:modelValue":t[6]||(t[6]=e=>o.addCfgFormData.ociCfgStr=e),type:"textarea",placeholder:o.placeholderText,rows:"6"},null,8,["modelValue","placeholder"])])),_:1})])),_:1},8,["model","rules"])])),_:1}),(0,s.bF)(C,{label:"上传文件",name:"upload"},{default:(0,s.k6)((()=>[(0,s.bF)(_,{class:"upload-demo",drag:"","http-request":l.handleFileUpload,multiple:"","show-file-list":!0,"file-list":o.fileList},{tip:(0,s.k6)((()=>t[24]||(t[24]=[(0,s.Lk)("div",{class:"el-upload__tip"}," ⭐要求：文件格式为.ini或者.txt，每个API配置的第一行是你[自定义的配置名称]，例：[首尔01]。 上传过程中会校验配置有效性，如不符合要求则无法添加成功~ ",-1)]))),default:(0,s.k6)((()=>[(0,s.bF)(F,{class:"el-icon--upload"},{default:(0,s.k6)((()=>[(0,s.bF)(y)])),_:1}),t[25]||(t[25]=(0,s.Lk)("div",{class:"el-upload__text"},[(0,s.eW)(" Drop file here or "),(0,s.Lk)("em",null,"click to upload")],-1))])),_:1},8,["http-request","file-list"])])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["modelValue"]),(0,s.bF)(I,{modelValue:o.checkDialogVisible,"onUpdate:modelValue":t[13]||(t[13]=e=>o.checkDialogVisible=e),title:"测活结果",width:"35%",onClose:t[14]||(t[14]=e=>o.checkDialogVisible=!1)},{footer:(0,s.k6)((()=>[(0,s.Lk)("div",Q,[(0,s.bF)(i,{type:"primary",onClick:t[12]||(t[12]=e=>o.checkDialogVisible=!1)},{default:(0,s.k6)((()=>t[27]||(t[27]=[(0,s.eW)(" 确定 ")]))),_:1})])])),default:(0,s.k6)((()=>[(0,s.Lk)("span",null,(0,k.v_)(this.checkResult),1)])),_:1},8,["modelValue"])],64)}a(1454);var H=a(2565),J=a(7815),Y=a(9623),Z=a(47),ee=a(2933),te={components:{ElTable:H.Up,ElTableColumn:H.o8,ElPagination:J.aQ,ElInput:Y.WK,ElButton:Z.S2,UploadFilled:W.UploadFilled},data(){return{checkLoading:!1,checkResult:"",users:[],pageParams:{keyword:"",currentPage:1,pageSize:5,isEnableCreate:null},total:2,selectedUsers:[],loading:!0,addLoading:!1,dialogVisible:!1,checkDialogVisible:!1,activeTab:"manual",fileList:[],addCfgFormData:{disabled:!1,username:"",ociCfgStr:""},formRules:{username:[{required:!0,message:"配置名称不能为空",trigger:"blur"},{min:1,message:"配置名称至少为 1 个字符",trigger:"blur"}],ociCfgStr:[{required:!0,message:"配置内容不能为空",trigger:"blur"},{min:10,message:"配置内容至少为 10 个字符",trigger:"blur"}]},placeholderText:"user=xxxxxx\nfingerprint=xxxxxx\ntenancy=xxxxxx\nregion=sa-saopaulo-1\nkey_file=br.pem\n"}},watch:{addCfgFormData:{handler(){this.validateForm()},deep:!0}},methods:{async fetchUsers(){this.loading=!0,this.$axios.post("/oci/userPage",{...this.pageParams}).then((e=>{this.users=e.data.data.records,this.total=e.data.data.total})).catch((e=>{console.error("Error:",e)})),this.loading=!1},async checkAlive(){this.checkLoading=!0,await this.$axios.post("/oci/checkAlive",{}).then((e=>{this.checkLoading=!1,e.data.success?(this.checkDialogVisible=!0,this.checkResult=e.data.msg):(0,m.nk)({message:e.data.msg,type:"error",duration:2e3}),this.fetchUsers()})).catch((e=>{console.error("Error:",e)}))},handlePageChange(e){this.pageParams.currentPage=e,this.fetchUsers()},handleSizeChange(e){this.pageParams.currentPage=1,this.pageParams.pageSize=e,this.fetchUsers()},handleSelectionChange(e){this.selectedUsers=e},handleFileUpload({file:e}){const t=new FileReader;t.onload=t=>{const a=t.target.result;a&&this.fileList.push(e)},t.readAsArrayBuffer(e)},async uploadFile(){this.addLoading=!0;const e=new FormData;this.fileList.forEach((t=>{e.append("fileList",t)})),await this.$axios.post("/oci/uploadCfg",e,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{e.data.success?(this.resetForm(),(0,m.nk)({message:e.data.msg,type:"success",duration:2e3})):(this.addLoading=!1,(0,m.nk)({message:e.data.msg,type:"error",duration:2e3})),this.fetchUsers()})).catch((e=>{console.error("Error:",e)})),this.resetForm()},resetForm(){this.addCfgFormData={disabled:!1,username:"",ociCfgStr:""},this.fileList=[],this.addLoading=!1,this.dialogVisible=!1},async addUser(){this.addLoading=!0,await this.$axios.post("/oci/addCfg",{...this.addCfgFormData}).then((e=>{e.data.success?(this.resetForm(),(0,m.nk)({message:e.data.msg,type:"success",duration:2e3})):(this.addLoading=!1,(0,m.nk)({message:e.data.msg,type:"error",duration:2e3})),this.fetchUsers()})).catch((e=>{console.error("Error:",e)}))},viewDetails(e){this.$router.push({path:"/dashboard/ociInstanceInfo",query:{cfgId:e.id,username:e.username}})},createInstance(e){this.$router.push({path:"/dashboard/createInstance",query:{row:JSON.stringify(e)}})},createBatch(){this.$router.push({path:"/dashboard/ociCreateInstanceBatch",query:{row:JSON.stringify(this.selectedUsers)}})},async releaseSecurityRule(e){try{const t=await ee.s.confirm("确定要放行默认 VCN 安全列表的所有端口及协议吗？","安全列表放行操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});"confirm"===t&&await this.$axios.post("/oci/releaseSecurityRule",{ociCfgId:e.id}).then((e=>{e.data.success?(0,m.nk)({message:e.data.msg,type:"success",duration:2e3}):(0,m.nk)({message:e.data.msg,type:"error",duration:2e3}),this.fetchUsers()})).catch((e=>{console.error("Error:",e)}))}catch(t){(0,m.nk)({message:"操作已取消",type:"info",duration:2e3})}},handleStopCreate(e){const t=window.confirm("确定要停止开机任务吗?");t?this.stopCreate(e):this.$message.info("已取消")},stopCreate(e){this.$axios.post("/oci/stopCreate",{userId:e.id}).then((e=>{e.data.success?(0,m.nk)({message:e.data.msg,type:"success",duration:2e3}):(0,m.nk)({message:e.data.msg,type:"error",duration:2e3}),this.fetchUsers()})).catch((e=>{console.error("Error:",e)}))},showDeleteSelected(){const e=window.confirm("确定要删除这些配置吗?");e?this.deleteSelected():this.$message.info("取消删除")},deleteSelected(){const e=this.selectedUsers.map((e=>e.id));this.$axios.post("/oci/removeCfg",{idList:e}).then((e=>{e.data.success?(0,m.nk)({message:e.data.msg,type:"success",duration:2e3}):(0,m.nk)({message:e.data.msg,type:"error",duration:2e3}),this.fetchUsers()})).catch((e=>{console.error("Error:",e)}))},validateForm(){this.$refs.formRef.validate((e=>{this.addCfgFormData.disabled=e}))}},mounted(){this.fetchUsers()}};const ae=(0,r.A)(te,[["render",G],["__scopeId","data-v-2c4fde96"]]);var ne=ae;const se={style:{"margin-left":"20px"}};function oe(e,t,a,n,o,l){const i=(0,s.g2)("el-button"),r=(0,s.g2)("el-text"),c=(0,s.g2)("el-divider"),d=(0,s.g2)("el-input-number"),u=(0,s.g2)("el-form-item"),h=(0,s.g2)("el-radio"),p=(0,s.g2)("el-radio-group"),m=(0,s.g2)("el-input"),g=(0,s.g2)("el-form");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.bF)(i,{onClick:l.goBack},{default:(0,s.k6)((()=>t[8]||(t[8]=[(0,s.eW)("返回配置页面")]))),_:1},8,["onClick"]),(0,s.Lk)("span",se,[(0,s.bF)(r,{type:"primary"},{default:(0,s.k6)((()=>[(0,s.eW)("配置："+(0,k.v_)(this.user.username)+" —— 新增开机任务",1)])),_:1})]),(0,s.bF)(c),(0,s.bF)(g,{model:o.form,"label-width":"auto",style:{"max-width":"600px"}},{default:(0,s.k6)((()=>[(0,s.bF)(u,{label:"开机数量："},{default:(0,s.k6)((()=>[(0,s.bF)(d,{modelValue:o.form.createNumbers,"onUpdate:modelValue":t[0]||(t[0]=e=>o.form.createNumbers=e),min:1,max:99999},{suffix:(0,s.k6)((()=>t[9]||(t[9]=[(0,s.Lk)("span",null,"台",-1)]))),_:1},8,["modelValue"])])),_:1}),(0,s.bF)(u,{label:"时间间隔："},{default:(0,s.k6)((()=>[(0,s.bF)(d,{modelValue:o.form.interval,"onUpdate:modelValue":t[1]||(t[1]=e=>o.form.interval=e),min:1,max:99999},{suffix:(0,s.k6)((()=>t[10]||(t[10]=[(0,s.Lk)("span",null,"秒",-1)]))),_:1},8,["modelValue"])])),_:1}),(0,s.bF)(u,{label:"CPU："},{default:(0,s.k6)((()=>[(0,s.bF)(d,{modelValue:o.form.ocpus,"onUpdate:modelValue":t[2]||(t[2]=e=>o.form.ocpus=e),min:1,max:99999},{suffix:(0,s.k6)((()=>t[11]||(t[11]=[(0,s.Lk)("span",null,"核",-1)]))),_:1},8,["modelValue"])])),_:1}),(0,s.bF)(u,{label:"内存："},{default:(0,s.k6)((()=>[(0,s.bF)(d,{modelValue:o.form.memory,"onUpdate:modelValue":t[3]||(t[3]=e=>o.form.memory=e),min:1,max:99999},{suffix:(0,s.k6)((()=>t[12]||(t[12]=[(0,s.Lk)("span",null,"GB",-1)]))),_:1},8,["modelValue"])])),_:1}),(0,s.bF)(u,{label:"磁盘空间："},{default:(0,s.k6)((()=>[(0,s.bF)(d,{modelValue:o.form.disk,"onUpdate:modelValue":t[4]||(t[4]=e=>o.form.disk=e),min:50,max:99999},{suffix:(0,s.k6)((()=>t[13]||(t[13]=[(0,s.Lk)("span",null,"GB",-1)]))),_:1},8,["modelValue"])])),_:1}),(0,s.bF)(u,{label:"系统架构："},{default:(0,s.k6)((()=>[(0,s.bF)(p,{modelValue:o.form.architecture,"onUpdate:modelValue":t[5]||(t[5]=e=>o.form.architecture=e)},{default:(0,s.k6)((()=>[(0,s.bF)(h,{value:"ARM"},{default:(0,s.k6)((()=>t[14]||(t[14]=[(0,s.eW)("ARM")]))),_:1}),(0,s.bF)(h,{value:"AMD"},{default:(0,s.k6)((()=>t[15]||(t[15]=[(0,s.eW)("AMD")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,s.bF)(u,{label:"系统类型："},{default:(0,s.k6)((()=>[(0,s.bF)(p,{modelValue:o.form.operationSystem,"onUpdate:modelValue":t[6]||(t[6]=e=>o.form.operationSystem=e)},{default:(0,s.k6)((()=>[(0,s.bF)(h,{value:"Canonical Ubuntu"},{default:(0,s.k6)((()=>t[16]||(t[16]=[(0,s.eW)("Canonical Ubuntu")]))),_:1}),(0,s.bF)(h,{value:"Oracle Autonomous Linux"},{default:(0,s.k6)((()=>t[17]||(t[17]=[(0,s.eW)("Oracle Autonomous Linux")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,s.bF)(u,{label:"root密码：",style:{width:"70%"}},{default:(0,s.k6)((()=>[(0,s.bF)(m,{placeholder:"请输入root密码",modelValue:o.form.rootPassword,"onUpdate:modelValue":t[7]||(t[7]=e=>o.form.rootPassword=e),clearable:""},{append:(0,s.k6)((()=>[(0,s.bF)(i,{type:"text",onClick:l.generatePassword,icon:e.Search},{default:(0,s.k6)((()=>t[18]||(t[18]=[(0,s.eW)("随机生成")]))),_:1},8,["onClick","icon"])])),_:1},8,["modelValue"])])),_:1}),(0,s.bF)(u,null,{default:(0,s.k6)((()=>[(0,s.bF)(i,{type:"primary",onClick:l.onSubmit,loading:o.loading},{default:(0,s.k6)((()=>t[19]||(t[19]=[(0,s.eW)("开机")]))),_:1},8,["onClick","loading"]),(0,s.bF)(i,{onClick:l.goBack},{default:(0,s.k6)((()=>t[20]||(t[20]=[(0,s.eW)("取消")]))),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])],64)}var le={components:{ElButton:Z.S2},data(){return{loading:!1,user:{},form:{userId:"",ocpus:1,memory:1,disk:50,architecture:"ARM",interval:60,createNumbers:1,operationSystem:"Canonical Ubuntu",rootPassword:""}}},mounted(){this.user=JSON.parse(this.$route.query.row||"{}"),this.form.userId=this.user.id},methods:{goBack(){this.$router.back()},generatePassword(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let t="";for(let a=0;a<8;a++)t+=e.charAt(Math.floor(Math.random()*e.length));this.form.rootPassword=t},onSubmit(){this.loading=!0,this.$axios.post("/oci/createInstance",{...this.form}).then((e=>{e.data.success?(this.loading=!1,(0,m.nk)({message:e.data.msg,type:"success",duration:2e3}),this.goBack()):(0,m.nk)({message:e.data.msg,type:"error",duration:2e3})})).catch((e=>{console.error("Error:",e)}))}}};const ie=(0,r.A)(le,[["render",oe]]);var re=ie;const ce={style:{"margin-left":"20px"}},de={class:"demo-collapse"},ue={style:{"margin-left":"20px"}},he={style:{"margin-left":"20px"}},pe={style:{"margin-left":"20px"}},me={style:{"margin-left":"20px"}},ge={style:{"margin-left":"20px"}},fe={class:"instance-list"},be={class:"header"},ke={style:{"line-height":"1"}},Ce={style:{display:"flex","align-items":"center",margin:"10px"}},ye={style:{display:"flex","align-items":"center",margin:"10px"}},Fe={style:{display:"flex","align-items":"center",margin:"10px"}},_e={style:{display:"flex","align-items":"center",margin:"10px"}},ve={style:{display:"flex","flex-wrap":"wrap",gap:"10px"}},Ie={style:{display:"flex","align-items":"center",margin:"10px"}},we={style:{display:"flex","align-items":"center",margin:"10px"}};function xe(e,t,a,o,l,i){const r=(0,s.g2)("el-button"),c=(0,s.g2)("el-text"),d=(0,s.g2)("el-divider"),u=(0,s.g2)("info-filled"),h=(0,s.g2)("el-icon"),p=(0,s.g2)("el-collapse-item"),m=(0,s.g2)("el-collapse"),g=(0,s.g2)("cpu"),f=(0,s.g2)("el-tag"),b=(0,s.g2)("el-tooltip"),C=(0,s.g2)("el-button-group"),y=(0,s.g2)("el-input"),F=(0,s.g2)("el-dialog"),_=(0,s.g2)("el-checkbox"),v=(0,s.g2)("el-col"),I=(0,s.g2)("el-row"),w=(0,s.g2)("el-form-item"),x=(0,s.g2)("el-form");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.bF)(r,{onClick:i.goBack},{default:(0,s.k6)((()=>t[9]||(t[9]=[(0,s.eW)("返回配置列表")]))),_:1},8,["onClick"]),(0,s.bF)(r,{onClick:i.getOciCfgDetails,loading:l.flushLoading},{default:(0,s.k6)((()=>t[10]||(t[10]=[(0,s.eW)("刷新页面")]))),_:1},8,["onClick","loading"]),(0,s.Lk)("span",ce,[(0,s.bF)(c,{type:"primary"},{default:(0,s.k6)((()=>[(0,s.eW)("配置："+(0,k.v_)(this.user.username)+" —— 配置详情",1)])),_:1})]),(0,s.bF)(d,{class:"divider"}),(0,s.Lk)("div",de,[(0,s.bF)(m,{accordion:""},{default:(0,s.k6)((()=>[(0,s.bF)(p,{name:"1"},{title:(0,s.k6)((()=>[(0,s.bF)(h,{class:"header-icon"},{default:(0,s.k6)((()=>[(0,s.bF)(u)])),_:1}),t[11]||(t[11]=(0,s.eW)(" API配置详情（点击向下⬇展开） "))])),default:(0,s.k6)((()=>[(0,s.Lk)("div",null,[(0,s.Lk)("span",ue,[(0,s.bF)(c,{type:"info"},{default:(0,s.k6)((()=>[(0,s.eW)("region="+(0,k.v_)(this.ociCfgDetails.region),1)])),_:1})])]),(0,s.Lk)("div",null,[(0,s.Lk)("span",he,[(0,s.bF)(c,{type:"info"},{default:(0,s.k6)((()=>[(0,s.eW)("user="+(0,k.v_)(this.ociCfgDetails.userId),1)])),_:1})])]),(0,s.Lk)("div",null,[(0,s.Lk)("span",pe,[(0,s.bF)(c,{type:"info"},{default:(0,s.k6)((()=>[(0,s.eW)("tenancy="+(0,k.v_)(this.ociCfgDetails.tenantId),1)])),_:1})])]),(0,s.Lk)("div",null,[(0,s.Lk)("span",me,[(0,s.bF)(c,{type:"info"},{default:(0,s.k6)((()=>[(0,s.eW)("fingerprint="+(0,k.v_)(this.ociCfgDetails.fingerprint),1)])),_:1})])]),(0,s.Lk)("div",null,[(0,s.Lk)("span",ge,[(0,s.bF)(c,{type:"info"},{default:(0,s.k6)((()=>[(0,s.eW)("key_file="+(0,k.v_)(this.ociCfgDetails.privateKeyPath),1)])),_:1})])])])),_:1})])),_:1})]),(0,s.Lk)("div",fe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.ociCfgDetails.instanceList,(e=>((0,s.uX)(),(0,s.CE)("div",{key:e.ocId,class:"instance-card"},[(0,s.Lk)("div",be,[(0,s.bF)(h,{class:"server-icon"},{default:(0,s.k6)((()=>[(0,s.bF)(g)])),_:1}),(0,s.Lk)("h3",null,(0,k.v_)(e.name),1)]),(0,s.bF)(d,{class:"divider"}),(0,s.Lk)("div",ke,[(0,s.Lk)("p",Ce,[t[12]||(t[12]=(0,s.Lk)("strong",{style:{"min-width":"100px"}},"Region",-1)),(0,s.bF)(f,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,k.v_)(e.region),1)])),_:2},1024)]),(0,s.Lk)("p",ye,[t[13]||(t[13]=(0,s.Lk)("strong",{style:{"min-width":"100px"}},"状态",-1)),(0,s.bF)(f,{type:-1!==e.state.indexOf("RUNNING")?"success":"info"},{default:(0,s.k6)((()=>[(0,s.eW)((0,k.v_)(e.state),1)])),_:2},1032,["type"])]),(0,s.Lk)("p",Fe,[t[14]||(t[14]=(0,s.Lk)("strong",{style:{"min-width":"100px"}},"Shape",-1)),(0,s.bF)(f,{type:-1!==e.shape.indexOf("A1")?"success":"info"},{default:(0,s.k6)((()=>[(0,s.eW)((0,k.v_)(e.shape),1)])),_:2},1032,["type"])]),(0,s.Lk)("div",_e,[t[15]||(t[15]=(0,s.Lk)("strong",{style:{"min-width":"100px"}},"公网IP",-1)),(0,s.Lk)("div",ve,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.publicIp,((e,t)=>((0,s.uX)(),(0,s.Wv)(f,{key:t,effect:"plain"},{default:(0,s.k6)((()=>[(0,s.eW)((0,k.v_)(e),1)])),_:2},1024)))),128))])]),(0,s.Lk)("p",Ie,[t[16]||(t[16]=(0,s.Lk)("strong",{style:{"min-width":"100px"}},"配置",-1)),(0,s.bF)(f,{effect:"plain",type:"info"},{default:(0,s.k6)((()=>[(0,s.eW)((0,k.v_)(e.ocpus)+" 核 / "+(0,k.v_)(e.memory)+" GB / "+(0,k.v_)(e.bootVolumeSize)+" GB ",1)])),_:2},1024)]),(0,s.Lk)("p",we,[t[17]||(t[17]=(0,s.Lk)("strong",{style:{"min-width":"100px"}},"创建时间",-1)),(0,s.bF)(f,{effect:"plain",type:"info"},{default:(0,s.k6)((()=>[(0,s.eW)((0,k.v_)(e.createTime),1)])),_:2},1024)])]),(0,s.bF)(d,{class:"divider"}),(0,s.bF)(C,{class:"ml-4"},{default:(0,s.k6)((()=>[(0,s.bF)(b,{content:"更换IP",placement:"bottom"},{default:(0,s.k6)((()=>[1!==e.enableChangeIp?((0,s.uX)(),(0,s.Wv)(r,{key:0,onClick:t=>i.handleChangeIp(e.ocId),icon:"HelpFilled"},null,8,["onClick"])):(0,s.Q3)("",!0)])),_:2},1024),(0,s.bF)(b,{content:"停止更换IP",placement:"bottom"},{default:(0,s.k6)((()=>[1===e.enableChangeIp?((0,s.uX)(),(0,s.Wv)(r,{key:0,onClick:t=>i.handleStopChangeIp(e.ocId),icon:"HelpFilled",type:"danger"},null,8,["onClick"])):(0,s.Q3)("",!0)])),_:2},1024),(0,s.bF)(b,{content:"编辑实例配置",placement:"bottom"},{default:(0,s.k6)((()=>[(0,s.bF)(r,{onClick:t=>i.handleUpdateInstanceCfg(e.ocId),icon:"Edit",type:"primary"},null,8,["onClick"])])),_:2},1024),(0,s.bF)(b,{content:"启动实例",placement:"bottom"},{default:(0,s.k6)((()=>[-1===e.state.indexOf("RUNNING")?((0,s.uX)(),(0,s.Wv)(r,{key:0,type:"success",icon:"VideoPlay",disabled:-1!==e.state.indexOf("RUNNING"),onClick:t=>i.updateInstanceState(e.ocId,"START")},null,8,["disabled","onClick"])):(0,s.Q3)("",!0)])),_:2},1024),(0,s.bF)(b,{content:"停止实例",placement:"bottom"},{default:(0,s.k6)((()=>[-1===e.state.indexOf("STOPPED")?((0,s.uX)(),(0,s.Wv)(r,{key:0,type:"info",icon:"VideoPause",disabled:-1!==e.state.indexOf("STOPPED"),onClick:t=>i.updateInstanceState(e.ocId,"STOP")},null,8,["disabled","onClick"])):(0,s.Q3)("",!0)])),_:2},1024),(0,s.bF)(b,{content:"重启实例",placement:"bottom"},{default:(0,s.k6)((()=>[(0,s.bF)(r,{type:"warning",icon:"Refresh",onClick:t=>i.updateInstanceState(e.ocId,"RESET")},null,8,["onClick"])])),_:2},1024),(0,s.bF)(b,{content:"终止实例（操作不可逆，请谨慎操作）",placement:"bottom"},{default:(0,s.k6)((()=>[(0,s.bF)(r,{type:"danger",icon:"Delete",disabled:-1!==e.state.indexOf("TERMINATING"),onClick:t=>i.handleTerminateInstance(e.ocId)},null,8,["disabled","onClick"])])),_:2},1024)])),_:2},1024)])))),128))]),(0,s.bF)(F,{modelValue:l.dialogVisible,"onUpdate:modelValue":t[2]||(t[2]=e=>l.dialogVisible=e),title:"可指定多个 CIDR 网段，回车保存，传空则随机更换一个IP",width:"40%",onClose:t[3]||(t[3]=e=>l.dialogVisible=!1)},{footer:(0,s.k6)((()=>[(0,s.bF)(r,{onClick:t[1]||(t[1]=e=>l.dialogVisible=!1)},{default:(0,s.k6)((()=>t[19]||(t[19]=[(0,s.eW)("取消")]))),_:1}),(0,s.bF)(r,{type:"primary",onClick:i.changeIp,loading:l.changeIpLoading},{default:(0,s.k6)((()=>t[20]||(t[20]=[(0,s.eW)("新增更换IP任务")]))),_:1},8,["onClick","loading"])])),default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.changeIpParams.cidrList,(e=>((0,s.uX)(),(0,s.Wv)(f,{key:e,closable:"",onClose:t=>i.handleClose(e)},{default:(0,s.k6)((()=>[(0,s.eW)((0,k.v_)(e),1)])),_:2},1032,["onClose"])))),128)),l.inputVisible?((0,s.uX)(),(0,s.Wv)(y,{key:0,ref:"InputRef",modelValue:l.inputValue,"onUpdate:modelValue":t[0]||(t[0]=e=>l.inputValue=e),class:"w-20",onKeyup:(0,n.jR)(i.handleInputConfirm,["enter"]),onBlur:i.handleInputConfirm},null,8,["modelValue","onKeyup","onBlur"])):((0,s.uX)(),(0,s.Wv)(r,{key:1,class:"button-new-tag",size:"small",onClick:i.showInput},{default:(0,s.k6)((()=>t[18]||(t[18]=[(0,s.eW)(" + New CIDR")]))),_:1},8,["onClick"]))])),_:1},8,["modelValue"]),(0,s.bF)(F,{title:"终止实例",modelValue:l.terminateDialogVisible,"onUpdate:modelValue":t[7]||(t[7]=e=>l.terminateDialogVisible=e),width:"500px",onClose:t[8]||(t[8]=e=>l.terminateDialogVisible=!1)},{footer:(0,s.k6)((()=>[(0,s.bF)(r,{onClick:t[6]||(t[6]=e=>l.terminateDialogVisible=!1)},{default:(0,s.k6)((()=>t[23]||(t[23]=[(0,s.eW)("取消")]))),_:1}),(0,s.bF)(r,{onClick:i.sendCaptcha,loading:l.sendLoading},{default:(0,s.k6)((()=>t[24]||(t[24]=[(0,s.eW)("发送验证码")]))),_:1},8,["onClick","loading"]),(0,s.bF)(r,{type:"danger",disabled:""===l.form.verificationCode,loading:l.terminateLoading,onClick:i.terminateInstance},{default:(0,s.k6)((()=>t[25]||(t[25]=[(0,s.eW)(" 确认终止 ")]))),_:1},8,["disabled","loading","onClick"])])),default:(0,s.k6)((()=>[(0,s.Lk)("div",null,[t[22]||(t[22]=(0,s.Lk)("p",null,"终止实例将不可恢复，请确认以下选项：",-1)),(0,s.bF)(I,null,{default:(0,s.k6)((()=>[(0,s.bF)(v,{span:24},{default:(0,s.k6)((()=>[(0,s.bF)(_,{modelValue:l.retainBootVolume,"onUpdate:modelValue":t[4]||(t[4]=e=>l.retainBootVolume=e)},{default:(0,s.k6)((()=>t[21]||(t[21]=[(0,s.eW)(" 保留引导卷及数据 ")]))),_:1},8,["modelValue"])])),_:1})])),_:1}),(0,s.bF)(d,{class:"divider"}),(0,s.bF)(I,null,{default:(0,s.k6)((()=>[(0,s.bF)(v,{span:24},{default:(0,s.k6)((()=>[(0,s.bF)(x,{model:l.form,ref:"form","label-width":"70px"},{default:(0,s.k6)((()=>[(0,s.bF)(w,{label:"验证码"},{default:(0,s.k6)((()=>[(0,s.bF)(y,{modelValue:l.form.verificationCode,"onUpdate:modelValue":t[5]||(t[5]=e=>l.form.verificationCode=e),placeholder:"请输入验证码",maxlength:"10",clearable:""},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1})])),_:1})])])),_:1},8,["modelValue"])],64)}var Pe={components:{cpu:W.cpu},data(){return{flushLoading:!1,changeIpLoading:!1,sendLoading:!1,dialogVisible:!1,terminateDialogVisible:!1,terminateLoading:!1,retainBootVolume:!1,form:{verificationCode:""},inputVisible:!1,inputValue:"",user:{},changeIpParams:{ociCfgId:"",instanceId:"",cidrList:[]},ociCfgDetails:{},UpdateInstanceStateParams:{ociCfgId:"",instanceId:"",action:""},SendCaptchaParams:{ociCfgId:"",instanceId:""},TerminateInstanceParams:{ociCfgId:"",instanceId:"",preserveBootVolume:0,captcha:""}}},mounted(){this.user.id=this.$route.query.cfgId,this.user.username=this.$route.query.username,this.changeIpParams.ociCfgId=this.$route.query.cfgId,this.getOciCfgDetails()},methods:{goBack(){this.$router.back()},handleClose(e){const t=this.changeIpParams.cidrList.indexOf(e);-1!==t&&this.changeIpParams.cidrList.splice(t,1)},handleStopChangeIp(e){const t=window.confirm("确定要停止更换IP任务吗?");t?this.stopChangeIp(e):this.$message.info("已取消")},handleUpdateInstanceCfg(e){this.$router.push({path:"/dashboard/ociUpdateInstanceCfg",query:{ocId:e,ociCfgId:this.user.id,username:this.user.username}})},stopChangeIp(e){this.$axios.post("/oci/stopChangeIp",{instanceId:e}).then((e=>{e.data.success?(0,m.nk)({message:e.data.msg,type:"success",duration:2e3}):(0,m.nk)({message:e.data.msg,type:"error",duration:2e3}),this.getOciCfgDetails()})).catch((e=>{console.error("Error:",e)}))},showInput(){this.inputVisible=!0,this.$nextTick((()=>{this.$refs.InputRef.focus()}))},handleInputConfirm(){this.inputValue&&!this.changeIpParams.cidrList.includes(this.inputValue)&&this.changeIpParams.cidrList.push(this.inputValue),this.inputValue="",this.inputVisible=!1},async getOciCfgDetails(){this.ociCfgDetails.instanceList=[],this.flushLoading=!0,await this.$axios.post("/oci/details",{id:this.changeIpParams.ociCfgId}).then((e=>{e.data.success?(this.ociCfgDetails=e.data.data,(0,m.nk)({message:e.data.msg,type:"success",duration:2e3}),this.flushLoading=!1):(0,m.nk)({message:e.data.msg,type:"error",duration:2e3})})).catch((e=>{console.error("Error:",e)}))},handleChangeIp(e){this.dialogVisible=!0,this.changeIpParams.instanceId=e},changeIp(){this.changeIpLoading=!0,this.$axios.post("/oci/changeIp",{...this.changeIpParams}).then((e=>{e.data.success?((0,m.nk)({message:e.data.msg,type:"success",duration:2e3}),this.changeIpLoading=!1,this.dialogVisible=!1,this.getOciCfgDetails()):(0,m.nk)({message:e.data.msg,type:"error",duration:2e3})})).catch((e=>{console.error("Error:",e)}))},async updateInstanceState(e,t){let a="";switch(t){case"START":a="确定要启动实例吗？";break;case"STOP":a="确定要停止实例吗？";break;case"RESET":a="确定要重新启动实例吗？";break;default:a="确定要执行此操作吗？"}try{const n=await ee.s.confirm(a,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});"confirm"===n&&(this.UpdateInstanceStateParams.ociCfgId=this.user.id,this.UpdateInstanceStateParams.instanceId=e,this.UpdateInstanceStateParams.action=t,await this.$axios.post("/oci/updateInstanceState",{...this.UpdateInstanceStateParams}).then((e=>{e.data.success?((0,m.nk)({message:e.data.msg,type:"success",duration:2e3}),this.getOciCfgDetails()):(0,m.nk)({message:e.data.msg,type:"error",duration:2e3})})).catch((e=>{console.error("Error:",e),(0,m.nk)({message:"更新实例状态时出错",type:"error",duration:2e3})})))}catch(n){(0,m.nk)({message:"操作已取消",type:"info",duration:2e3})}},handleTerminateInstance(e){this.TerminateInstanceParams.instanceId=e,this.terminateDialogVisible=!0},sendCaptcha(){this.sendLoading=!0,this.SendCaptchaParams.ociCfgId=this.user.id,this.SendCaptchaParams.instanceId=this.TerminateInstanceParams.instanceId,this.$axios.post("/oci/sendCaptcha",{...this.SendCaptchaParams}).then((e=>{e.data.success?((0,m.nk)({message:e.data.msg,type:"success",duration:2e3}),this.changeIpLoading=!1,this.dialogVisible=!1,this.sendLoading=!1):(0,m.nk)({message:e.data.msg,type:"error",duration:2e3})})).catch((e=>{console.error("Error:",e)}))},async terminateInstance(){this.terminateLoading=!0,this.TerminateInstanceParams.ociCfgId=this.user.id,this.TerminateInstanceParams.preserveBootVolume=!0===this.retainBootVolume?1:0,this.TerminateInstanceParams.captcha=this.form.verificationCode,this.$axios.post("/oci/terminateInstance",{...this.TerminateInstanceParams}).then((e=>{e.data.success?((0,m.nk)({message:e.data.msg,type:"success",duration:2e3}),this.getOciCfgDetails()):(0,m.nk)({message:e.data.msg,type:"error",duration:2e3})})).catch((e=>{console.error("Error:",e),(0,m.nk)({message:"终止实例时发生错误",type:"error",duration:2e3})})).finally((()=>{this.terminateLoading=!1,this.terminateDialogVisible=!1}))}}};const Se=(0,r.A)(Pe,[["render",xe]]);var Le=Se;const Ve={style:{"overflow-x":"auto"}};function We(e,t,a,n,o,l){const i=(0,s.g2)("el-button"),r=(0,s.g2)("el-input"),c=(0,s.g2)("el-option"),d=(0,s.g2)("el-select"),u=(0,s.g2)("el-table-column"),h=(0,s.g2)("el-tooltip"),p=(0,s.g2)("el-tag"),m=(0,s.g2)("el-table"),g=(0,s.g2)("el-pagination"),f=(0,s.gN)("loading");return(0,s.uX)(),(0,s.CE)("div",null,[(0,s.bF)(i,{type:"success",style:{"margin-bottom":"20px"},onClick:l.createTaskPage},{default:(0,s.k6)((()=>t[4]||(t[4]=[(0,s.eW)(" 刷新 ")]))),_:1},8,["onClick"]),(0,s.bF)(r,{modelValue:o.createTaskPageParams.keyword,"onUpdate:modelValue":t[0]||(t[0]=e=>o.createTaskPageParams.keyword=e),placeholder:"模糊搜索配置名称/区域",onInput:l.createTaskPage,clearable:"","prefix-icon":"Search",style:{"margin-left":"20px",width:"200px","margin-bottom":"20px"}},null,8,["modelValue","onInput"]),(0,s.bF)(d,{modelValue:o.createTaskPageParams.architecture,"onUpdate:modelValue":t[1]||(t[1]=e=>o.createTaskPageParams.architecture=e),onChange:l.createTaskPage,placeholder:"系统架构筛选",style:{"margin-left":"20px",width:"180px","margin-bottom":"20px"}},{default:(0,s.k6)((()=>[(0,s.bF)(c,{label:"全部",value:null}),(0,s.bF)(c,{label:"ARM",value:"ARM"}),(0,s.bF)(c,{label:"AMD",value:"AMD"})])),_:1},8,["modelValue","onChange"]),(0,s.bF)(i,{type:"danger",onClick:l.handleStopCreateBatch,disabled:!o.stopCreateBatchIds.length,style:{"margin-left":"20px","margin-bottom":"20px"}},{default:(0,s.k6)((()=>t[5]||(t[5]=[(0,s.eW)(" 批量停止 ")]))),_:1},8,["onClick","disabled"]),(0,s.Lk)("div",Ve,[(0,s.bo)(((0,s.uX)(),(0,s.Wv)(m,{data:o.createTaskRsp,style:{width:"100%","min-width":"800px"},onSelectionChange:l.handleSelectionChange},{default:(0,s.k6)((()=>[(0,s.bF)(u,{type:"selection",width:"35"}),(0,s.bF)(u,{label:"名称"},{default:(0,s.k6)((({row:e})=>[(0,s.bF)(h,{content:e.username,placement:"top"},{default:(0,s.k6)((()=>[(0,s.eW)((0,k.v_)(e.username),1)])),_:2},1032,["content"])])),_:1}),(0,s.bF)(u,{label:"区域"},{default:(0,s.k6)((({row:e})=>[(0,s.bF)(h,{content:e.region,placement:"top"},{default:(0,s.k6)((()=>[(0,s.bF)(p,{type:"primary"},{default:(0,s.k6)((()=>[(0,s.eW)((0,k.v_)(e.region),1)])),_:2},1024)])),_:2},1032,["content"])])),_:1}),(0,s.bF)(u,{prop:"ocpus",label:"CPU（核数）"}),(0,s.bF)(u,{prop:"memory",label:"内存（GB）"}),(0,s.bF)(u,{prop:"disk",label:"硬盘（GB）"}),(0,s.bF)(u,{prop:"operationSystem",label:"操作系统"}),(0,s.bF)(u,{label:"系统架构"},{default:(0,s.k6)((({row:e})=>[(0,s.bF)(p,{type:"ARM"===e.architecture?"success":"info"},{default:(0,s.k6)((()=>[(0,s.eW)((0,k.v_)(e.architecture),1)])),_:2},1032,["type"])])),_:1}),(0,s.bF)(u,{prop:"interval",label:"间隔（秒）"}),(0,s.bF)(u,{label:"数量"},{default:(0,s.k6)((({row:e})=>[(0,s.bF)(p,{type:"primary"},{default:(0,s.k6)((()=>[(0,s.eW)((0,k.v_)(e.createNumbers),1)])),_:2},1024)])),_:1}),(0,s.bF)(u,{label:"次数",sortable:""},{default:(0,s.k6)((({row:e})=>[(0,s.bF)(p,{type:"warning"},{default:(0,s.k6)((()=>[(0,s.eW)((0,k.v_)(e.counts),1)])),_:2},1024)])),_:1}),(0,s.bF)(u,{sortable:"",prop:"createTime",label:"创建时间"},{default:(0,s.k6)((({row:e})=>[(0,s.bF)(h,{content:e.createTime,placement:"top"},{default:(0,s.k6)((()=>[(0,s.bF)(p,{type:"info"},{default:(0,s.k6)((()=>[(0,s.eW)((0,k.v_)(e.createTime),1)])),_:2},1024)])),_:2},1032,["content"])])),_:1}),(0,s.bF)(u,{fixed:"right",label:"操作",width:"100"},{default:(0,s.k6)((({row:e})=>[(0,s.bF)(i,{onClick:t=>l.handleStopTask(e),type:"danger",link:""},{default:(0,s.k6)((()=>t[6]||(t[6]=[(0,s.eW)("停止")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","onSelectionChange"])),[[f,o.loading]])]),(0,s.bF)(g,{onCurrentChange:l.handlePageChange,onSizeChange:l.handleSizeChange,"current-page":o.createTaskPageParams.currentPage,"onUpdate:currentPage":t[2]||(t[2]=e=>o.createTaskPageParams.currentPage=e),"page-size":o.createTaskPageParams.pageSize,"onUpdate:pageSize":t[3]||(t[3]=e=>o.createTaskPageParams.pageSize=e),"page-sizes":[5,10,20,50],total:o.total,layout:"total, sizes, prev, pager, next, jumper",style:{"margin-top":"20px"}},null,8,["onCurrentChange","onSizeChange","current-page","page-size","total"])])}var Ee={components:{ElTable:H.Up,ElTableColumn:H.o8,ElPagination:J.aQ,ElInput:Y.WK,ElButton:Z.S2},data(){return{createTaskPageParams:{keyword:"",currentPage:1,pageSize:5,architecture:""},createTaskRsp:[],selectedTasks:[],total:0,stopCreateBatchIds:[],loading:!0}},mounted(){this.createTaskPage()},methods:{handlePageChange(e){this.createTaskPageParams.currentPage=e,this.createTaskPage()},handleSizeChange(e){this.createTaskPageParams.currentPage=1,this.createTaskPageParams.pageSize=e,this.createTaskPage()},handleSelectionChange(e){this.stopCreateBatchIds=e},createTaskPage(){this.loading=!0,this.$axios.post("/oci/createTaskPage",{...this.createTaskPageParams}).then((e=>{this.createTaskRsp=e.data.data.records,this.total=e.data.data.total})).catch((e=>{console.error("Error:",e)})),this.loading=!1},handleStopTask(e){const t=window.confirm("确定要停止 "+e.username+" 的这个开机任务吗?");t?(this.selectedTasks.push(e.id),this.$axios.post("/oci/stopCreateBatch",{idList:this.selectedTasks}).then((e=>{e.data.success?(0,m.nk)({message:e.data.msg,type:"success",duration:2e3}):(0,m.nk)({message:e.data.msg,type:"error",duration:2e3}),this.createTaskPage()})).catch((e=>{console.error("Error:",e)}))):this.$message.info("已取消")},handleStopCreateBatch(){const e=window.confirm("确定要停止这些开机任务吗");e?this.stopCreateBatch():this.$message.info("已取消")},stopCreateBatch(){const e=this.stopCreateBatchIds.map((e=>e.id));this.$axios.post("/oci/stopCreateBatch",{idList:e}).then((e=>{e.data.success?(0,m.nk)({message:e.data.msg,type:"success",duration:2e3}):(0,m.nk)({message:e.data.msg,type:"error",duration:2e3}),this.createTaskPage()})).catch((e=>{console.error("Error:",e)}))}}};const Te=(0,r.A)(Ee,[["render",We]]);var Ue=Te;const Ae={style:{"margin-left":"20px"}};function Be(e,t,a,n,o,l){const i=(0,s.g2)("el-button"),r=(0,s.g2)("el-text"),c=(0,s.g2)("el-divider"),d=(0,s.g2)("el-input-number"),u=(0,s.g2)("el-form-item"),h=(0,s.g2)("el-radio"),p=(0,s.g2)("el-radio-group"),m=(0,s.g2)("el-input"),g=(0,s.g2)("el-form");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.bF)(i,{onClick:l.goBack},{default:(0,s.k6)((()=>t[8]||(t[8]=[(0,s.eW)("返回配置页面")]))),_:1},8,["onClick"]),(0,s.Lk)("span",Ae,[(0,s.bF)(r,{type:"primary"},{default:(0,s.k6)((()=>[(0,s.eW)("配置："+(0,k.v_)(this.usernameList)+" 批量新增开机任务",1)])),_:1})]),(0,s.bF)(c),(0,s.bF)(g,{model:o.createInstanceBatchParams.instanceInfo,"label-width":"auto",style:{"max-width":"600px"}},{default:(0,s.k6)((()=>[(0,s.bF)(u,{label:"开机数量："},{default:(0,s.k6)((()=>[(0,s.bF)(d,{modelValue:o.createInstanceBatchParams.instanceInfo.createNumbers,"onUpdate:modelValue":t[0]||(t[0]=e=>o.createInstanceBatchParams.instanceInfo.createNumbers=e),min:1,max:99999},{suffix:(0,s.k6)((()=>t[9]||(t[9]=[(0,s.Lk)("span",null,"台",-1)]))),_:1},8,["modelValue"])])),_:1}),(0,s.bF)(u,{label:"时间间隔："},{default:(0,s.k6)((()=>[(0,s.bF)(d,{modelValue:o.createInstanceBatchParams.instanceInfo.interval,"onUpdate:modelValue":t[1]||(t[1]=e=>o.createInstanceBatchParams.instanceInfo.interval=e),min:1,max:99999},{suffix:(0,s.k6)((()=>t[10]||(t[10]=[(0,s.Lk)("span",null,"秒",-1)]))),_:1},8,["modelValue"])])),_:1}),(0,s.bF)(u,{label:"CPU："},{default:(0,s.k6)((()=>[(0,s.bF)(d,{modelValue:o.createInstanceBatchParams.instanceInfo.ocpus,"onUpdate:modelValue":t[2]||(t[2]=e=>o.createInstanceBatchParams.instanceInfo.ocpus=e),min:1,max:99999},{suffix:(0,s.k6)((()=>t[11]||(t[11]=[(0,s.Lk)("span",null,"核",-1)]))),_:1},8,["modelValue"])])),_:1}),(0,s.bF)(u,{label:"内存："},{default:(0,s.k6)((()=>[(0,s.bF)(d,{modelValue:o.createInstanceBatchParams.instanceInfo.memory,"onUpdate:modelValue":t[3]||(t[3]=e=>o.createInstanceBatchParams.instanceInfo.memory=e),min:1,max:99999},{suffix:(0,s.k6)((()=>t[12]||(t[12]=[(0,s.Lk)("span",null,"GB",-1)]))),_:1},8,["modelValue"])])),_:1}),(0,s.bF)(u,{label:"磁盘空间："},{default:(0,s.k6)((()=>[(0,s.bF)(d,{modelValue:o.createInstanceBatchParams.instanceInfo.disk,"onUpdate:modelValue":t[4]||(t[4]=e=>o.createInstanceBatchParams.instanceInfo.disk=e),min:50,max:99999},{suffix:(0,s.k6)((()=>t[13]||(t[13]=[(0,s.Lk)("span",null,"GB",-1)]))),_:1},8,["modelValue"])])),_:1}),(0,s.bF)(u,{label:"系统架构："},{default:(0,s.k6)((()=>[(0,s.bF)(p,{modelValue:o.createInstanceBatchParams.instanceInfo.architecture,"onUpdate:modelValue":t[5]||(t[5]=e=>o.createInstanceBatchParams.instanceInfo.architecture=e)},{default:(0,s.k6)((()=>[(0,s.bF)(h,{value:"ARM"},{default:(0,s.k6)((()=>t[14]||(t[14]=[(0,s.eW)("ARM")]))),_:1}),(0,s.bF)(h,{value:"AMD"},{default:(0,s.k6)((()=>t[15]||(t[15]=[(0,s.eW)("AMD")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,s.bF)(u,{label:"系统类型："},{default:(0,s.k6)((()=>[(0,s.bF)(p,{modelValue:o.createInstanceBatchParams.instanceInfo.operationSystem,"onUpdate:modelValue":t[6]||(t[6]=e=>o.createInstanceBatchParams.instanceInfo.operationSystem=e)},{default:(0,s.k6)((()=>[(0,s.bF)(h,{value:"Canonical Ubuntu"},{default:(0,s.k6)((()=>t[16]||(t[16]=[(0,s.eW)("Canonical Ubuntu")]))),_:1}),(0,s.bF)(h,{value:"Oracle Autonomous Linux"},{default:(0,s.k6)((()=>t[17]||(t[17]=[(0,s.eW)("Oracle Autonomous Linux")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,s.bF)(u,{label:"root密码：",style:{width:"70%"}},{default:(0,s.k6)((()=>[(0,s.bF)(m,{placeholder:"请输入root密码",modelValue:o.createInstanceBatchParams.instanceInfo.rootPassword,"onUpdate:modelValue":t[7]||(t[7]=e=>o.createInstanceBatchParams.instanceInfo.rootPassword=e),clearable:""},{append:(0,s.k6)((()=>[(0,s.bF)(i,{type:"text",onClick:l.generatePassword,icon:e.Search},{default:(0,s.k6)((()=>t[18]||(t[18]=[(0,s.eW)("随机生成")]))),_:1},8,["onClick","icon"])])),_:1},8,["modelValue"])])),_:1}),(0,s.bF)(u,null,{default:(0,s.k6)((()=>[(0,s.bF)(i,{type:"primary",onClick:l.onSubmit,loading:o.loading},{default:(0,s.k6)((()=>t[19]||(t[19]=[(0,s.eW)("开机")]))),_:1},8,["onClick","loading"]),(0,s.bF)(i,{onClick:l.goBack},{default:(0,s.k6)((()=>t[20]||(t[20]=[(0,s.eW)("取消")]))),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])],64)}var De={components:{ElButton:Z.S2},data(){return{loading:!1,users:[],usernameList:[],createInstanceBatchParams:{userIds:[],instanceInfo:{ocpus:1,memory:1,disk:50,architecture:"ARM",interval:60,createNumbers:1,operationSystem:"Canonical Ubuntu",rootPassword:""}}}},mounted(){this.users=JSON.parse(this.$route.query.row||"{}"),this.usernameList=this.users.map((e=>e.username)),this.createInstanceBatchParams.userIds=this.users.map((e=>e.id))},methods:{goBack(){this.$router.back()},generatePassword(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let t="";for(let a=0;a<8;a++)t+=e.charAt(Math.floor(Math.random()*e.length));this.createInstanceBatchParams.instanceInfo.rootPassword=t},onSubmit(){this.loading=!0,this.$axios.post("/oci/createInstanceBatch",{...this.createInstanceBatchParams}).then((e=>{e.data.success?(this.loading=!1,(0,m.nk)({message:e.data.msg,type:"success",duration:2e3}),this.goBack()):(0,m.nk)({message:e.data.msg,type:"error",duration:2e3})})).catch((e=>{console.error("Error:",e)}))}}};const Re=(0,r.A)(De,[["render",Be]]);var $e=Re;function Oe(e,t,a,n,o,l){const i=(0,s.g2)("el-scrollbar");return(0,s.uX)(),(0,s.Wv)(i,{class:"scrollbar",ref:"scrollContainer"},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.logMessages,((e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:(0,k.C4)(l.getLogLevelClass(e))},(0,k.v_)(e),3)))),128))])),_:1},512)}var Ne={data(){return{logMessages:[],ws:null,reconnectAttempts:0,maxReconnectAttempts:5,reconnectDelay:5e3,manualClose:!1,isReconnecting:!1}},mounted(){this.initWebSocket(),document.addEventListener("visibilitychange",this.handleVisibilityChange)},beforeUnmount(){this.closeWebSocket(),document.removeEventListener("visibilitychange",this.handleVisibilityChange)},methods:{getLogLevelClass(e){return e.includes("ERROR")?"error-log":e.includes("WARN")?"warn-log":"info-log"},initWebSocket(){if(this.ws&&(this.ws.readyState===WebSocket.OPEN||this.ws.readyState===WebSocket.CONNECTING))return void console.log("WebSocket is already connected or connecting");if(this.isReconnecting)return void console.log("Currently reconnecting, skipping new connection attempt");this.logMessages=[],this.manualClose=!1;const e=sessionStorage.getItem("token"),t=this.$axios.defaults.baseURL.replace(/^http/,"ws").replaceAll("/api",""),a=`${t}/logs?token=${e}`;this.ws=new WebSocket(a),this.ws.onopen=()=>{console.log("WebSocket connected"),(0,m.nk)({message:"WebSocket 连接成功，开始实时推送日志",type:"success",duration:2e3}),this.reconnectAttempts=0,this.isReconnecting=!1,this.startHeartbeat()},this.ws.onmessage=e=>{const t=e.data;this.logMessages.push(t),this.logMessages.length>100&&this.logMessages.shift(),this.scrollToBottom()},this.ws.onerror=e=>{console.error("WebSocket error:",e),this.handleReconnect()},this.ws.onclose=e=>{console.warn("WebSocket closed:",e),this.stopHeartbeat(),this.manualClose||this.handleReconnect()}},scrollToBottom(){this.$nextTick((()=>{const e=this.$refs.scrollContainer?.$el.querySelector(".el-scrollbar__wrap");e?e.scrollTop=e.scrollHeight:console.error("滚动容器未找到，请检查 el-scrollbar 的结构")}))},closeWebSocket(){this.ws&&(this.manualClose=!0,this.stopHeartbeat(),this.ws.close(),this.ws=null),this.logMessages=[]},startHeartbeat(){this.heartbeatInterval||(this.heartbeatInterval=setInterval((()=>{this.ws.readyState===WebSocket.OPEN&&this.ws.send("ping")}),3e4))},stopHeartbeat(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null)},handleReconnect(){this.isReconnecting||"hidden"===document.visibilityState?console.warn("Already reconnecting or page is hidden, skipping reconnect..."):this.reconnectAttempts>=this.maxReconnectAttempts?console.error("Max reconnect attempts reached. Giving up."):(this.isReconnecting=!0,setTimeout((()=>{this.reconnectAttempts++,console.log(`Reconnecting... (Attempt ${this.reconnectAttempts})`),this.initWebSocket()}),this.reconnectDelay))},handleVisibilityChange(){"hidden"===document.visibilityState?(console.log("Page hidden, closing WebSocket..."),this.stopHeartbeat(),this.closeWebSocket()):"visible"===document.visibilityState&&(console.log("Page visible, reconnecting WebSocket..."),this.initWebSocket())}}};const Me=(0,r.A)(Ne,[["render",Oe],["__scopeId","data-v-b2bf4ade"]]);var Xe=Me;const ze=[{path:"/",redirect:"/login"},{path:"/login",component:b},{path:"/dashboard",component:U,meta:{requiresAuth:!0},children:[{path:"",component:q},{path:"home",component:q},{path:"user",component:ne},{path:"createTask",component:Ue},{path:"ociLog",component:Xe},{path:"sysCfg",component:()=>a.e(572).then(a.bind(a,5572))},{path:"createInstance",component:re},{path:"ociInstanceInfo",component:Le},{path:"ociUpdateInstanceCfg",component:()=>a.e(64).then(a.bind(a,3064))},{path:"ociCreateInstanceBatch",component:$e}]}],je=(0,u.aE)({history:(0,u.LA)(),routes:ze});je.beforeEach(((e,t,a)=>{const n=sessionStorage.getItem("token");e.matched.some((e=>e.meta.requiresAuth))&&!n?a("/login"):(window.ws&&(console.log("Closing existing WebSocket connection before route change."),window.ws.close(),window.ws=null),a())}));var qe=je,Ke=a(9601),Qe=(a(4188),a(4373));Qe.A.defaults.baseURL=window.location.origin+"/api",Qe.A.interceptors.request.use((e=>{const t=sessionStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e}),(e=>Promise.reject(e))),Qe.A.interceptors.response.use((e=>e),(e=>(e.response&&401===e.response.status&&(sessionStorage.removeItem("token"),window.location.href="/login"),Promise.reject(e))));const Ge=(0,n.Ef)(d);Ge.use(qe),Ge.use(Ke.A);for(const[He,Je]of Object.entries(W))Ge.component(He,Je);Ge.config.globalProperties.$axios=Qe.A,Ge.mount("#app")}},t={};function a(n){var s=t[n];if(void 0!==s)return s.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,a),o.exports}a.m=e,function(){var e=[];a.O=function(t,n,s,o){if(!n){var l=1/0;for(d=0;d<e.length;d++){n=e[d][0],s=e[d][1],o=e[d][2];for(var i=!0,r=0;r<n.length;r++)(!1&o||l>=o)&&Object.keys(a.O).every((function(e){return a.O[e](n[r])}))?n.splice(r--,1):(i=!1,o<l&&(l=o));if(i){e.splice(d--,1);var c=s();void 0!==c&&(t=c)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[n,s,o]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){a.f={},a.e=function(e){return Promise.all(Object.keys(a.f).reduce((function(t,n){return a.f[n](e,t),t}),[]))}}(),function(){a.u=function(e){return"js/"+e+"."+{64:"8bf4cae8",572:"802205b5"}[e]+".js"}}(),function(){a.miniCssF=function(e){return"css/"+e+"."+{64:"40ec08f4",572:"b1c91cf6"}[e]+".css"}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="oci-help-web:";a.l=function(n,s,o,l){if(e[n])e[n].push(s);else{var i,r;if(void 0!==o)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==n||u.getAttribute("data-webpack")==t+o){i=u;break}}i||(r=!0,i=document.createElement("script"),i.charset="utf-8",i.timeout=120,a.nc&&i.setAttribute("nonce",a.nc),i.setAttribute("data-webpack",t+o),i.src=n),e[n]=[s];var h=function(t,a){i.onerror=i.onload=null,clearTimeout(p);var s=e[n];if(delete e[n],i.parentNode&&i.parentNode.removeChild(i),s&&s.forEach((function(e){return e(a)})),t)return t(a)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=h.bind(null,i.onerror),i.onload=h.bind(null,i.onload),r&&document.head.appendChild(i)}}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){a.p="/"}(),function(){if("undefined"!==typeof document){var e=function(e,t,n,s,o){var l=document.createElement("link");l.rel="stylesheet",l.type="text/css",a.nc&&(l.nonce=a.nc);var i=function(a){if(l.onerror=l.onload=null,"load"===a.type)s();else{var n=a&&a.type,i=a&&a.target&&a.target.href||t,r=new Error("Loading CSS chunk "+e+" failed.\n("+n+": "+i+")");r.name="ChunkLoadError",r.code="CSS_CHUNK_LOAD_FAILED",r.type=n,r.request=i,l.parentNode&&l.parentNode.removeChild(l),o(r)}};return l.onerror=l.onload=i,l.href=t,n?n.parentNode.insertBefore(l,n.nextSibling):document.head.appendChild(l),l},t=function(e,t){for(var a=document.getElementsByTagName("link"),n=0;n<a.length;n++){var s=a[n],o=s.getAttribute("data-href")||s.getAttribute("href");if("stylesheet"===s.rel&&(o===e||o===t))return s}var l=document.getElementsByTagName("style");for(n=0;n<l.length;n++){s=l[n],o=s.getAttribute("data-href");if(o===e||o===t)return s}},n=function(n){return new Promise((function(s,o){var l=a.miniCssF(n),i=a.p+l;if(t(l,i))return s();e(n,i,null,s,o)}))},s={524:0};a.f.miniCss=function(e,t){var a={64:1,572:1};s[e]?t.push(s[e]):0!==s[e]&&a[e]&&t.push(s[e]=n(e).then((function(){s[e]=0}),(function(t){throw delete s[e],t})))}}}(),function(){var e={524:0};a.f.j=function(t,n){var s=a.o(e,t)?e[t]:void 0;if(0!==s)if(s)n.push(s[2]);else{var o=new Promise((function(a,n){s=e[t]=[a,n]}));n.push(s[2]=o);var l=a.p+a.u(t),i=new Error,r=function(n){if(a.o(e,t)&&(s=e[t],0!==s&&(e[t]=void 0),s)){var o=n&&("load"===n.type?"missing":n.type),l=n&&n.target&&n.target.src;i.message="Loading chunk "+t+" failed.\n("+o+": "+l+")",i.name="ChunkLoadError",i.type=o,i.request=l,s[1](i)}};a.l(l,r,"chunk-"+t,t)}},a.O.j=function(t){return 0===e[t]};var t=function(t,n){var s,o,l=n[0],i=n[1],r=n[2],c=0;if(l.some((function(t){return 0!==e[t]}))){for(s in i)a.o(i,s)&&(a.m[s]=i[s]);if(r)var d=r(a)}for(t&&t(n);c<l.length;c++)o=l[c],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(d)},n=self["webpackChunkoci_help_web"]=self["webpackChunkoci_help_web"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=a.O(void 0,[504],(function(){return a(9995)}));n=a.O(n)})();
//# sourceMappingURL=app.beb50e95.js.map